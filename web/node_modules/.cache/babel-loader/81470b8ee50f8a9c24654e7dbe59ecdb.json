{"remainingRequest":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/babel-loader/lib/index.js!/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/raviailani/Downloads/django-vue-admin/web/src/layout/header-aside/components/header-user/userinfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/raviailani/Downloads/django-vue-admin/web/src/layout/header-aside/components/header-user/userinfo.vue","mtime":1674694301484},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/babel.config.js","mtime":1674694301461},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/babel-loader/lib/index.js","mtime":1674694549283},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js","mtime":1674694549360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL3JhdmlhaWxhbmkvRG93bmxvYWRzL2RqYW5nby12dWUtYWRtaW4vd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmRvdC1hbGwuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5zdGlja3kuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudGVzdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmpzb24uc3RyaW5naWZ5LmpzIjsKaW1wb3J0IHV0aWwgZnJvbSAnQC9saWJzL3V0aWwuanMnOwppbXBvcnQgeyByZXF1ZXN0IH0gZnJvbSAnQC9hcGkvc2VydmljZSc7CmltcG9ydCB7IG1hcEFjdGlvbnMgfSBmcm9tICd2dWV4JzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICd1c2VySW5mbycsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICB2YXIgdmFsaWRhdGVQYXNzID0gZnVuY3Rpb24gdmFsaWRhdGVQYXNzKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgewogICAgICB2YXIgcHdkUmVnZXggPSBuZXcgUmVnRXhwKCcoPz0uKlswLTldKSg/PS4qW2EtekEtWl0pLns4LDMwfScpOwogICAgICBpZiAodmFsdWUgPT09ICcnKSB7CiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCfor7fovpPlhaXlr4bnoIEnKSk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IF90aGlzLnVzZXJQYXNzd29yZEluZm8ub2xkUGFzc3dvcmQpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+WOn+WvhueggeS4juaWsOWvhueggeS4gOiHtCcpKTsKICAgICAgfSBlbHNlIGlmICghcHdkUmVnZXgudGVzdCh2YWx1ZSkpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+aCqOeahOWvhueggeWkjeadguW6puWkquS9jijlr4bnoIHkuK3lv4XpobvljIXlkKvlrZfmr43jgIHmlbDlrZcpJykpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChfdGhpcy51c2VyUGFzc3dvcmRJbmZvLm5ld1Bhc3N3b3JkMiAhPT0gJycpIHsKICAgICAgICAgIF90aGlzLiRyZWZzLnVzZXJQYXNzd29yZEZvcm0udmFsaWRhdGVGaWVsZCgnbmV3UGFzc3dvcmQyJyk7CiAgICAgICAgfQogICAgICAgIGNhbGxiYWNrKCk7CiAgICAgIH0KICAgIH07CiAgICB2YXIgdmFsaWRhdGVQYXNzMiA9IGZ1bmN0aW9uIHZhbGlkYXRlUGFzczIocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSB7CiAgICAgIGlmICh2YWx1ZSA9PT0gJycpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+ivt+WGjeasoei+k+WFpeWvhueggScpKTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSAhPT0gX3RoaXMudXNlclBhc3N3b3JkSW5mby5uZXdQYXNzd29yZCkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcign5Lik5qyh6L6T5YWl5a+G56CB5LiN5LiA6Ie0IScpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgcG9zaXRpb246ICdsZWZ0JywKICAgICAgYWN0aXZlTmFtZTogJ3VzZXJJbmZvJywKICAgICAgYWN0aW9uOiB1dGlsLmJhc2VVUkwoKSArICdhcGkvc3lzdGVtL2ZpbGUvJywKICAgICAgaGVhZGVyczogewogICAgICAgIEF1dGhvcml6YXRpb246ICdKV1QgJyArIHV0aWwuY29va2llcy5nZXQoJ3Rva2VuJykKICAgICAgfSwKICAgICAgZmlsZUxpc3Q6IFtdLAogICAgICB1c2VySW5mbzogewogICAgICAgIG5hbWU6ICcnLAogICAgICAgIGdlbmRlcjogJycsCiAgICAgICAgbW9iaWxlOiAnJywKICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgIGVtYWlsOiAnJwogICAgICB9LAogICAgICB1c2VySW5mb3J1bGVzOiB7CiAgICAgICAgbmFtZTogW3sKICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgbWVzc2FnZTogJ+ivt+i+k+WFpeaYteensCcsCiAgICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgICB9XSwKICAgICAgICBtb2JpbGU6IFt7CiAgICAgICAgICBwYXR0ZXJuOiAvXjFbMy05XVxkezl9JC8sCiAgICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5q2j56Gu5omL5py65Y+3JwogICAgICAgIH1dCiAgICAgIH0sCiAgICAgIHVzZXJQYXNzd29yZEluZm86IHsKICAgICAgICBvbGRQYXNzd29yZDogJycsCiAgICAgICAgbmV3UGFzc3dvcmQ6ICcnLAogICAgICAgIG5ld1Bhc3N3b3JkMjogJycKICAgICAgfSwKICAgICAgcGFzc3dvcmRSdWxlczogewogICAgICAgIG9sZFBhc3N3b3JkOiBbewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5Y6f5a+G56CBJywKICAgICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICAgIH1dLAogICAgICAgIG5ld1Bhc3N3b3JkOiBbewogICAgICAgICAgdmFsaWRhdG9yOiB2YWxpZGF0ZVBhc3MsCiAgICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgICB9XSwKICAgICAgICBuZXdQYXNzd29yZDI6IFt7CiAgICAgICAgICB2YWxpZGF0b3I6IHZhbGlkYXRlUGFzczIsCiAgICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgICB9XQogICAgICB9CiAgICB9OwogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHRoaXMuZ2V0Q3VycmVudFVzZXJJbmZvKCk7CiAgfSwKICBtZXRob2RzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcEFjdGlvbnMoJ2QyYWRtaW4vYWNjb3VudCcsIFsnbG9nb3V0J10pKSwge30sIHsKICAgIC8qKgogICAgICog6I635Y+W5b2T5YmN55So5oi35L+h5oGvCiAgICAgKi8KICAgIGdldEN1cnJlbnRVc2VySW5mbzogZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXJJbmZvKCkgewogICAgICB2YXIgX3NlbGYgPSB0aGlzOwogICAgICByZXR1cm4gcmVxdWVzdCh7CiAgICAgICAgdXJsOiAnL2FwaS9zeXN0ZW0vdXNlci91c2VyX2luZm8vJywKICAgICAgICBtZXRob2Q6ICdnZXQnLAogICAgICAgIHBhcmFtczoge30KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3NlbGYudXNlckluZm8gPSByZXMuZGF0YTsKICAgICAgfSk7CiAgICB9LAogICAgLyoqCiAgICAgKiDmm7TmlrDnlKjmiLfkv6Hmga8KICAgICAqLwogICAgdXBkYXRlSW5mbzogZnVuY3Rpb24gdXBkYXRlSW5mbygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIHZhciBfc2VsZiA9IHRoaXM7CiAgICAgIF9zZWxmLiRyZWZzLnVzZXJJbmZvRm9ybS52YWxpZGF0ZShmdW5jdGlvbiAodmFsaWQpIHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHZhciB1c2VySW5mbyA9IF9zZWxmLnVzZXJJbmZvOwogICAgICAgICAgZGVsZXRlIHVzZXJJbmZvLnJvbGU7CiAgICAgICAgICByZXF1ZXN0KHsKICAgICAgICAgICAgdXJsOiAnL2FwaS9zeXN0ZW0vdXNlci91cGRhdGVfdXNlcl9pbmZvLycsCiAgICAgICAgICAgIG1ldGhvZDogJ3B1dCcsCiAgICAgICAgICAgIGRhdGE6IHVzZXJJbmZvCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3NlbGYuJG1lc3NhZ2Uuc3VjY2Vzcygn5L+u5pS55oiQ5YqfJyk7CiAgICAgICAgICAgIF9zZWxmLmdldEN1cnJlbnRVc2VySW5mbygpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOagoemqjOWksei0pQogICAgICAgICAgLy8g55m75b2V6KGo5Y2V5qCh6aqM5aSx6LSlCiAgICAgICAgICBfdGhpczIuJG1lc3NhZ2UuZXJyb3IoJ+ihqOWNleagoemqjOWksei0pe+8jOivt+ajgOafpScpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8g6YeN572uCiAgICByZXNldEZvcm06IGZ1bmN0aW9uIHJlc2V0Rm9ybShuYW1lKSB7CiAgICAgIHZhciBfc2VsZiA9IHRoaXM7CiAgICAgIGlmIChuYW1lID09PSAnaW5mbycpIHsKICAgICAgICBfc2VsZi5nZXRDdXJyZW50VXNlckluZm8oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBfc2VsZi51c2VyUGFzc3dvcmRGb3JtID0ge307CiAgICAgIH0KICAgIH0sCiAgICAvLyB0YWLliIfmjaIKICAgIGhhbmRsZUNsaWNrOiBmdW5jdGlvbiBoYW5kbGVDbGljayh0YWIsIGV2ZW50KSB7CiAgICAgIHZhciBfc2VsZiA9IHRoaXM7CiAgICAgIGlmICh0YWIucGFuZU5hbWUgPT09ICd1c2VySW5mbycpIHsKICAgICAgICBfc2VsZi4kcmVmcy51c2VyUGFzc3dvcmRGb3JtLnJlc2V0RmllbGRzKCk7CiAgICAgICAgX3NlbGYuZ2V0Q3VycmVudFVzZXJJbmZvKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3NlbGYuJHJlZnMudXNlckluZm9Gb3JtLnJlc2V0RmllbGRzKCk7CiAgICAgIH0KICAgIH0sCiAgICAvKioKICAgICAqIOmHjeaWsOiuvue9ruWvhueggQogICAgICovCiAgICBzZXR0aW5nUGFzc3dvcmQ6IGZ1bmN0aW9uIHNldHRpbmdQYXNzd29yZCgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CiAgICAgIHZhciBfc2VsZiA9IHRoaXM7CiAgICAgIF9zZWxmLiRyZWZzLnVzZXJQYXNzd29yZEZvcm0udmFsaWRhdGUoZnVuY3Rpb24gKHZhbGlkKSB7CiAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICB2YXIgdXNlcklkID0gdXRpbC5jb29raWVzLmdldCgndXVpZCcpOwogICAgICAgICAgaWYgKHVzZXJJZCkgewogICAgICAgICAgICB2YXIgcGFyYW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShfc2VsZi51c2VyUGFzc3dvcmRJbmZvKSk7CiAgICAgICAgICAgIHBhcmFtcy5vbGRQYXNzd29yZCA9IF9zZWxmLiRtZDUocGFyYW1zLm9sZFBhc3N3b3JkKTsKICAgICAgICAgICAgcGFyYW1zLm5ld1Bhc3N3b3JkID0gX3NlbGYuJG1kNShwYXJhbXMubmV3UGFzc3dvcmQpOwogICAgICAgICAgICBwYXJhbXMubmV3UGFzc3dvcmQyID0gX3NlbGYuJG1kNShwYXJhbXMubmV3UGFzc3dvcmQyKTsKICAgICAgICAgICAgcmVxdWVzdCh7CiAgICAgICAgICAgICAgdXJsOiAnL2FwaS9zeXN0ZW0vdXNlci8nICsgdXNlcklkICsgJy9jaGFuZ2VfcGFzc3dvcmQvJywKICAgICAgICAgICAgICBtZXRob2Q6ICdwdXQnLAogICAgICAgICAgICAgIGRhdGE6IHBhcmFtcwogICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgICBfc2VsZi5hY3RpdmVOYW1lID0gJ3VzZXJJbmZvJzsKICAgICAgICAgICAgICBfc2VsZi4kbWVzc2FnZS5zdWNjZXNzKCfkv67mlLnmiJDlip8nKTsKICAgICAgICAgICAgICBfc2VsZi5sb2dvdXQoe30pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g5qCh6aqM5aSx6LSlCiAgICAgICAgICAvLyDnmbvlvZXooajljZXmoKHpqozlpLHotKUKICAgICAgICAgIF90aGlzMy4kbWVzc2FnZS5lcnJvcign6KGo5Y2V5qCh6aqM5aSx6LSl77yM6K+35qOA5p+lJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvKioKICAgICAqIOWktOWDj+S4iuS8oAogICAgICogQHBhcmFtIHJlcwogICAgICogQHBhcmFtIGZpbGUKICAgICAqLwogICAgaGFuZGxlQXZhdGFyU3VjY2VzczogZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VjY2VzcyhyZXMsIGZpbGUpIHsKICAgICAgdGhpcy51c2VySW5mby5hdmF0YXIgPSByZXM7CiAgICB9CiAgfSkKfTs="},{"version":3,"mappings":";;;;;;;;;AAmHA;AACA;AACA;AACA;EACAA;EACAC;IAAA;IACA;MACA;MACA;QACAC;MACA;QACAA;MACA;QACAA;MACA;QACA;UACA;QACA;QACAA;MACA;IACA;IACA;MACA;QACAA;MACA;QACAA;MACA;QACAA;MACA;IACA;IACA;MACAC;MACAC;MACAC;MACAC;QACAC;MACA;MACAC;MACAC;QACAT;QACAU;QACAC;QACAC;QACAC;MACA;MACAC;QACAd;UAAAe;UAAAC;UAAAC;QAAA;QACAN;UAAAO;UAAAF;QAAA;MACA;MACAG;QACAC;QACAC;QACAC;MACA;MACAC;QACAH,cACA;UACAL;UACAC;UACAC;QACA,EACA;QACAI;UAAAG;UAAAP;QAAA;QACAK;UAAAE;UAAAP;QAAA;MACA;IACA;EACA;EACAQ;IACA;EACA;EACAC,yCACAC;IACA;AACA;AACA;IACAC;MACA;MACA;QACAC;QACAC;QACAC;MACA;QACAC;MACA;IACA;IACA;AACA;AACA;IACAC;MAAA;MACA;MAEAD;QACA;UACA;UACA;UACAE;YACAL;YACAC;YACA7B;UACA;YACA+B;YACAA;UACA;QACA;UACA;UACA;UACA;QACA;MACA;IACA;IACA;IACAG;MACA;MACA;QACAH;MACA;QACAA;MACA;IACA;IACA;IACAI;MACA;MACA;QACAJ;QACAA;MACA;QACAA;MACA;IACA;IACA;AACA;AACA;IACAK;MAAA;MACA;MAEAL;QACA;UACA;UACA;YACA;YACAD;YACAA;YACAA;YACAG;cACAL;cACAC;cACA7B;YACA;cACA+B;cACAA;cACAA;YACA;UACA;QACA;UACA;UACA;UACA;QACA;MACA;IACA;IACA;AACA;AACA;AACA;AACA;IACAM;MACA;IACA;EAAA;AAEA","names":["name","data","callback","position","activeName","action","headers","Authorization","fileList","userInfo","gender","mobile","avatar","email","userInforules","required","message","trigger","pattern","userPasswordInfo","oldPassword","newPassword","newPassword2","passwordRules","validator","mounted","methods","mapActions","getCurrentUserInfo","url","method","params","_self","updateInfo","request","resetForm","handleClick","settingPassword","handleAvatarSuccess"],"sourceRoot":"src/layout/header-aside/components/header-user","sources":["userinfo.vue"],"sourcesContent":["<template>\n  <d2-container class=\"page\">\n    <el-tabs v-model=\"activeName\" @tab-click=\"handleClick\">\n      <el-tab-pane label=\"用户设置\" name=\"userInfo\">\n        <el-row :gutter=\"20\">\n          <el-col :span=\"10\" :offset=\"6\">\n            <el-form\n              ref=\"userInfoForm\"\n              label-width=\"100px\"\n              :model=\"userInfo\"\n              required-asterisk\n              :rules=\"userInforules\"\n              :label-position=\"position\"\n              center\n            >\n              <el-form-item prop=\"avatar\" label=\"头像\">\n                <d2p-cropper-uploader :value=\"userInfo.avatar || '/image/avatar.png'\" @input=\"handleAvatarSuccess\"/>\n              </el-form-item>\n              <el-form-item prop=\"name\" required label=\"昵称\">\n                <el-input v-model=\"userInfo.name\" clearable></el-input>\n              </el-form-item>\n              <el-form-item label=\"电话号码\" required prop=\"mobile\">\n                <el-input v-model=\"userInfo.mobile\" clearable></el-input>\n              </el-form-item>\n              <el-form-item label=\"邮箱\" prop=\"email\">\n                <el-input v-model=\"userInfo.email\" clearable></el-input>\n              </el-form-item>\n              <el-form-item label=\"性別\" prop=\"gender\">\n                <el-radio-group v-model=\"userInfo.gender\">\n                  <el-radio :label=\"1\">男</el-radio>\n                  <el-radio :label=\"0\">女</el-radio>\n                  <el-radio :label=\"-1\">未知</el-radio>\n                </el-radio-group>\n              </el-form-item>\n              <el-form-item label=\"用户名\" prop=\"dept\">\n                <el-input :value=\"userInfo.username\" clearable disabled></el-input>\n              </el-form-item>\n              <el-form-item label=\"所属部门\" prop=\"dept\">\n                <el-input :value=\"userInfo.dept_info && userInfo.dept_info.dept_name\" clearable disabled></el-input>\n              </el-form-item>\n              <el-form-item label=\"当前角色\" prop=\"role\">\n                <el-select :value=\"userInfo.role\" multiple placeholder=\"请选择\" disabled style=\"width: 100%;\">\n                  <el-option\n                    v-for=\"item in userInfo.role_info\"\n                    :key=\"item.id\"\n                    :label=\"item.name\"\n                    :value=\"item.id\">\n                  </el-option>\n                </el-select>\n              </el-form-item>\n              <el-form-item>\n                <el-button @click=\"updateInfo\" type=\"primary\">\n                  <i class=\"fa fa-check\"></i>\n                  更新\n                </el-button>\n                <el-button @click=\"resetForm('info')\" type=\"info\">\n                  <i class=\"fa fa-reply-all\"></i>\n                  重置\n                </el-button>\n              </el-form-item>\n            </el-form>\n          </el-col>\n        </el-row>\n      </el-tab-pane>\n      <el-tab-pane label=\"密码设置\" name=\"passwrod\">\n        <el-row :gutter=\"20\">\n          <el-col :span=\"10\" :offset=\"6\">\n            <el-form\n              ref=\"userPasswordForm\"\n              :model=\"userPasswordInfo\"\n              required-asterisk\n              label-width=\"100px\"\n              :label-position=\"position\"\n              :rules=\"passwordRules\"\n              center\n            >\n              <el-form-item label=\"原密码\" required prop=\"oldPassword\">\n                <el-input\n                  v-model=\"userPasswordInfo.oldPassword\"\n                  placeholder=\"请输入原始密码\"\n                  clearable\n                ></el-input>\n              </el-form-item>\n              <el-form-item required prop=\"newPassword\" label=\"新密码\">\n                <el-input\n                  type=\"password\"\n                  v-model=\"userPasswordInfo.newPassword\"\n                  placeholder=\"请输入新密码\"\n                  clearable\n                ></el-input>\n              </el-form-item>\n              <el-form-item required prop=\"newPassword2\" label=\"确认密码\">\n                <el-input\n                  type=\"password\"\n                  v-model=\"userPasswordInfo.newPassword2\"\n                  placeholder=\"请再次输入新密码\"\n                  clearable\n                ></el-input>\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" @click=\"settingPassword\">\n                  <i class=\"fa fa-check\"></i>提交\n                </el-button>\n                <el-button @click=\"resetForm('passwordForm')\" type=\"info\">\n                  <i class=\"fa fa-reply-all\"></i>重置\n                </el-button>\n              </el-form-item>\n            </el-form>\n          </el-col>\n        </el-row>\n      </el-tab-pane>\n    </el-tabs>\n  </d2-container>\n</template>\n<script>\nimport util from '@/libs/util.js'\nimport { request } from '@/api/service'\nimport { mapActions } from 'vuex'\nexport default {\n  name: 'userInfo',\n  data () {\n    var validatePass = (rule, value, callback) => {\n      const pwdRegex = new RegExp('(?=.*[0-9])(?=.*[a-zA-Z]).{8,30}')\n      if (value === '') {\n        callback(new Error('请输入密码'))\n      } else if (value === this.userPasswordInfo.oldPassword) {\n        callback(new Error('原密码与新密码一致'))\n      } else if (!pwdRegex.test(value)) {\n        callback(new Error('您的密码复杂度太低(密码中必须包含字母、数字)'))\n      } else {\n        if (this.userPasswordInfo.newPassword2 !== '') {\n          this.$refs.userPasswordForm.validateField('newPassword2')\n        }\n        callback()\n      }\n    }\n    var validatePass2 = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请再次输入密码'))\n      } else if (value !== this.userPasswordInfo.newPassword) {\n        callback(new Error('两次输入密码不一致!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      position: 'left',\n      activeName: 'userInfo',\n      action: util.baseURL() + 'api/system/file/',\n      headers: {\n        Authorization: 'JWT ' + util.cookies.get('token')\n      },\n      fileList: [],\n      userInfo: {\n        name: '',\n        gender: '',\n        mobile: '',\n        avatar: '',\n        email: ''\n      },\n      userInforules: {\n        name: [{ required: true, message: '请输入昵称', trigger: 'blur' }],\n        mobile: [{ pattern: /^1[3-9]\\d{9}$/, message: '请输入正确手机号' }]\n      },\n      userPasswordInfo: {\n        oldPassword: '',\n        newPassword: '',\n        newPassword2: ''\n      },\n      passwordRules: {\n        oldPassword: [\n          {\n            required: true,\n            message: '请输入原密码',\n            trigger: 'blur'\n          }\n        ],\n        newPassword: [{ validator: validatePass, trigger: 'blur' }],\n        newPassword2: [{ validator: validatePass2, trigger: 'blur' }]\n      }\n    }\n  },\n  mounted () {\n    this.getCurrentUserInfo()\n  },\n  methods: {\n    ...mapActions('d2admin/account', ['logout']),\n    /**\n     * 获取当前用户信息\n     */\n    getCurrentUserInfo () {\n      const _self = this\n      return request({\n        url: '/api/system/user/user_info/',\n        method: 'get',\n        params: {}\n      }).then((res) => {\n        _self.userInfo = res.data\n      })\n    },\n    /**\n     * 更新用户信息\n     */\n    updateInfo () {\n      const _self = this\n\n      _self.$refs.userInfoForm.validate((valid) => {\n        if (valid) {\n          const userInfo = _self.userInfo\n          delete userInfo.role\n          request({\n            url: '/api/system/user/update_user_info/',\n            method: 'put',\n            data: userInfo\n          }).then((res) => {\n            _self.$message.success('修改成功')\n            _self.getCurrentUserInfo()\n          })\n        } else {\n          // 校验失败\n          // 登录表单校验失败\n          this.$message.error('表单校验失败，请检查')\n        }\n      })\n    },\n    // 重置\n    resetForm (name) {\n      const _self = this\n      if (name === 'info') {\n        _self.getCurrentUserInfo()\n      } else {\n        _self.userPasswordForm = {}\n      }\n    },\n    // tab切换\n    handleClick (tab, event) {\n      const _self = this\n      if (tab.paneName === 'userInfo') {\n        _self.$refs.userPasswordForm.resetFields()\n        _self.getCurrentUserInfo()\n      } else {\n        _self.$refs.userInfoForm.resetFields()\n      }\n    },\n    /**\n     * 重新设置密码\n     */\n    settingPassword () {\n      const _self = this\n\n      _self.$refs.userPasswordForm.validate((valid) => {\n        if (valid) {\n          const userId = util.cookies.get('uuid')\n          if (userId) {\n            const params = JSON.parse(JSON.stringify(_self.userPasswordInfo))\n            params.oldPassword = _self.$md5(params.oldPassword)\n            params.newPassword = _self.$md5(params.newPassword)\n            params.newPassword2 = _self.$md5(params.newPassword2)\n            request({\n              url: '/api/system/user/' + userId + '/change_password/',\n              method: 'put',\n              data: params\n            }).then((res) => {\n              _self.activeName = 'userInfo'\n              _self.$message.success('修改成功')\n              _self.logout({})\n            })\n          }\n        } else {\n          // 校验失败\n          // 登录表单校验失败\n          this.$message.error('表单校验失败，请检查')\n        }\n      })\n    },\n    /**\n     * 头像上传\n     * @param res\n     * @param file\n     */\n    handleAvatarSuccess (res, file) {\n      this.userInfo.avatar = res\n    }\n  }\n}\n</script>\n"]}]}