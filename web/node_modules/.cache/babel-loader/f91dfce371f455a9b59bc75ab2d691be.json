{"remainingRequest":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/babel-loader/lib/index.js!/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/raviailani/Downloads/django-vue-admin/web/node_modules/d2p-extends/src/file-uploader/lib/file-uploader.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/d2p-extends/src/file-uploader/lib/file-uploader.vue","mtime":1674694550313},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/babel.config.js","mtime":1674694301461},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/babel-loader/lib/index.js","mtime":1674694549283},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js","mtime":1674694549360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL3JhdmlhaWxhbmkvRG93bmxvYWRzL2RqYW5nby12dWUtYWRtaW4vd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIi9Vc2Vycy9yYXZpYWlsYW5pL0Rvd25sb2Fkcy9kamFuZ28tdnVlLWFkbWluL3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlci5qcyI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIi9Vc2Vycy9yYXZpYWlsYW5pL0Rvd25sb2Fkcy9kamFuZ28tdnVlLWFkbWluL3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vcmVnZW5lcmF0b3JSdW50aW1lLmpzIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9yYXZpYWlsYW5pL0Rvd25sb2Fkcy9kamFuZ28tdnVlLWFkbWluL3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCBfdHlwZW9mIGZyb20gIi9Vc2Vycy9yYXZpYWlsYW5pL0Rvd25sb2Fkcy9kamFuZ28tdnVlLWFkbWluL3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgU3BhcmtNRDUgZnJvbSAnc3BhcmstbWQ1JzsKaW1wb3J0IEQycFVwbG9hZGVyIGZyb20gJy4uLy4uL3VwbG9hZGVyJzsKaW1wb3J0IGxvZGFzaCBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyBkMkNydWRQbHVzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZDItY3J1ZC1wbHVzJzsKaW1wb3J0IGxvZyBmcm9tICcuLi8uLi91dGlscy91dGlsLmxvZyc7Ci8vIOaWh+S7tuS4iuS8oOe7hOS7tizkvp3otZZEMnBVcGxvYWRlcgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ2QycC1maWxlLXVwbG9hZGVyJywKICBtaXhpbnM6IFtkMkNydWRQbHVzLmlucHV0QmFzZV0sCiAgcHJvcHM6IHsKICAgIC8vIOmAieaLqeaWh+S7tuaMiemSrueahOWkp+WwjwogICAgYnRuU2l6ZTogewogICAgICBkZWZhdWx0OiAnc21hbGwnCiAgICB9LAogICAgLy8g6YCJ5oup5paH5Lu25oyJ6ZKu55qE5ZCN56ewCiAgICBidG5OYW1lOiB7CiAgICAgIGRlZmF1bHQ6ICfpgInmi6nmlofku7YnCiAgICB9LAogICAgLy8g5Y+v6YCJ5ZOq5Lqb57G75Z6L55qE5paH5Lu2CiAgICBhY2NlcHQ6IHt9LAogICAgLy8g5LiK5Lyg5ZCO56uv57G75Z6L77yMW2NvcyxxaW5pdSxhbGlvc3MsZm9ybV0KICAgIHR5cGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiB1bmRlZmluZWQgLy8g5LiK5Lyg57G75Z6L77yaZm9ybSBjb3MgcWluaXUgIGFsaW9zcwogICAgfSwKCiAgICAvLyDlgLzvvJp1cmw8YnIvPgogICAgLy8g5oiWIFt1cmwxLHVybDJdPGJyLz4KICAgIC8vIOaIliB7dXJsOid1cmwnLG1kNTonJyxzaXplOm51bWJlcn08YnIvPgogICAgLy8g5oiWIFt7dXJsOid1cmwnLG1kNTonJyxzaXplOm51bWJlcn1dPGJyLz4KICAgIC8vIDxici8+CiAgICAvLyBsaW1pdD0xIOaXtiBpbnB1dOS6i+S7tui/lOWbniB7dXJsOid1cmwnLG1kNTonJyxzaXplOm51bWJlcn08YnIvPgogICAgLy8gbGltaXQ+MSDml7YgaW5wdXTkuovku7bov5Tlm54g5pWw57uEPGJyLz4KICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5LCBPYmplY3RdCiAgICB9LAogICAgLy8g5qC35byP5ZCO57yAIOi/veWKoOWIsHVybOeahOWQjumdou+8jOi/m+ihjOWbvueJh+WkhOeQhu+8jOmcgOimgeWIsOWvueixoeWtmOWCqOW5s+WPsOmFjee9ruagt+W8jwogICAgc3VmZml4OiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICB9LAogICAgLy8g6L+U5Zue57G75Z6LOiB1cmw95LuF6L+U5Zue6ZO+5o6lLCBvYmplY3Q95YyF5ZCrbWQ15ZKMc2l6ZSAsIGtleT3ku4Xov5Tlm57mlofku7ZrZXkKICAgIHJldHVyblR5cGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAndXJsJwogICAgfSwKICAgIC8vIOiHquWumuS5ieWPguaVsAogICAgY3VzdG9tOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfSwKICAgIC8vIOWGhemDqOWwgeijhVtlbC11cGxvYWRdKGh0dHBzOi8vZWxlbWVudC5lbGVtZS5jbi8jL3poLUNOL2NvbXBvbmVudC91cGxvYWQp57uE5Lu255qE5bGe5oCn5Y+C5pWwPGJyLz4KICAgIC8vIOazqOaEj++8jGZvcm3mlrnlvI/kuIrkvKDnmoRhY3Rpb27jgIFuYW1l44CBaGVhZGVyc+etieWPguaVsOS4jeWcqOatpOiuvue9rgogICAgZWxQcm9wczogewogICAgICB0eXBlOiBPYmplY3QKICAgIH0sCiAgICAvLyDpooTop4jlr7nor53moYbnmoTphY3nva4KICAgIHByZXZpZXc6IHsKICAgICAgdHlwZTogT2JqZWN0CiAgICB9LAogICAgLy8g5paH5Lu25aSn5bCP6ZmQ5Yi2IDxici8+CiAgICAvLyDlpoLmnpzkvKDlhaV7bGltaXQsdGlwKGZpbGVTaXplLGxpbWl0KXt2bS4kbWVzc2FnZSgn5Y+v5Lul6Ieq5a6a5LmJ5o+Q56S6Jyl9fQogICAgc2l6ZUxpbWl0OiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgT2JqZWN0OiBPYmplY3QKICAgIH0sCiAgICAvLyDmnoTlu7rkuIvovb11cmzmlrnms5UKICAgIGJ1aWxkVXJsOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uLAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCh2YWx1ZSwgaXRlbSkgewogICAgICAgIHJldHVybiBfdHlwZW9mKHZhbHVlKSA9PT0gJ29iamVjdCcgPyBpdGVtLnVybCA6IHZhbHVlOwogICAgICB9CiAgICB9LAogICAgLy8g5LiK5Lyg57uE5Lu25Y+C5pWw77yM5Lya5Li05pe26KaG55uW5YWo5bGA5LiK5Lyg6YWN572u5Y+C5pWwW2QycC11cGxvYWRlcl0oL2d1aWRlL2V4dGVuZHMvdXBsb2FkZXIuaHRtbCkKICAgIHVwbG9hZGVyOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIHt9OwogICAgICB9CiAgICB9LAogICAgLy8g5LiOZWwtdXBsb2Fk5LiA6Ie0CiAgICBiZWZvcmVVcGxvYWQ6IHsKICAgICAgdHlwZTogRnVuY3Rpb24KICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBmaWxlTGlzdDogW10sCiAgICAgIGNvbnRleHQ6IHt9LAogICAgICBkaWFsb2dJbWFnZVVybDogJycsCiAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICBhdmF0YXJMb2FkaW5nOiB1bmRlZmluZWQKICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdGhpcy5lbWl0VmFsdWUgPSB0aGlzLnZhbHVlOwogICAgdGhpcy5pbml0VmFsdWUodGhpcy52YWx1ZSk7CiAgfSwKICB3YXRjaDogewogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKF92YWx1ZSkgewogICAgICBpZiAodGhpcy5kaXNwYXRjaCkgewogICAgICAgIHRoaXMuZGlzcGF0Y2goJ0VsRm9ybUl0ZW0nLCAnZWwuZm9ybS5ibHVyJyk7CiAgICAgIH0KICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlJywgX3ZhbHVlKTsKICAgICAgaWYgKHRoaXMuZW1pdFZhbHVlID09PSBfdmFsdWUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5lbWl0VmFsdWUgPSBfdmFsdWU7CiAgICAgIHRoaXMuaW5pdFZhbHVlKF92YWx1ZSk7CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgX2VsUHJvcHM6IGZ1bmN0aW9uIF9lbFByb3BzKCkgewogICAgICB2YXIgZGVmYXVsdEVsUHJvcHMgPSB0aGlzLmdldERlZmF1bHRFbFByb3BzKCk7CiAgICAgIE9iamVjdC5hc3NpZ24oZGVmYXVsdEVsUHJvcHMsIHRoaXMuZWxQcm9wcyk7CiAgICAgIHJldHVybiBkZWZhdWx0RWxQcm9wczsKICAgIH0sCiAgICBhdmF0YXJVcmw6IGZ1bmN0aW9uIGF2YXRhclVybCgpIHsKICAgICAgaWYgKHRoaXMuZmlsZUxpc3QubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBmaWxlID0gdGhpcy5maWxlTGlzdFswXTsKICAgICAgICBsb2cuZGVidWcoJ2ZpbGUsJywgZmlsZSwgZmlsZS5zdGF0dXMpOwogICAgICAgIGlmIChmaWxlLnJlc3BvbnNlICE9IG51bGwgJiYgZmlsZS5yZXNwb25zZS51cmwgIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGZpbGUucmVzcG9uc2UudXJsOwogICAgICAgIH0gZWxzZSBpZiAoZmlsZS51cmwgIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGZpbGUudXJsOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCiAgICB1cGxvYWRDbGFzczogZnVuY3Rpb24gdXBsb2FkQ2xhc3MoKSB7CiAgICAgIGlmICh0aGlzLl9lbFByb3BzLmxpc3RUeXBlID09PSAnYXZhdGFyJykgewogICAgICAgIHJldHVybiAnYXZhdGFyLXVwbG9hZGVyJzsKICAgICAgfSBlbHNlIGlmICh0aGlzLl9lbFByb3BzLmxpc3RUeXBlID09PSAncGljdHVyZS1jYXJkJykgewogICAgICAgIGlmICh0aGlzLmZpbGVMaXN0ICYmIHRoaXMuX2VsUHJvcHMubGltaXQgIT09IDAgJiYgdGhpcy5maWxlTGlzdC5sZW5ndGggPj0gdGhpcy5fZWxQcm9wcy5saW1pdCkgewogICAgICAgICAgcmV0dXJuICdpbWFnZS11cGxvYWRlciBoaWRlLXBsdXMnOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJ2ltYWdlLXVwbG9hZGVyJzsKICAgICAgfQogICAgICByZXR1cm4gJ2ZpbGUtdXBsb2FkZXInOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgaGFuZGxlQmx1cjogZnVuY3Rpb24gaGFuZGxlQmx1cigpIHsKICAgICAgY29uc29sZS5sb2coJ2JsdXInKTsKICAgIH0sCiAgICBnZXREZWZhdWx0RWxQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdEVsUHJvcHMoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiB7CiAgICAgICAgbGltaXQ6IDAsCiAgICAgICAgbGlzdFR5cGU6ICd0ZXh0JywKICAgICAgICBzaG93RmlsZUxpc3Q6IHRydWUsCiAgICAgICAgYWN0aW9uOiAnJywKICAgICAgICBvblByZXZpZXc6IGZ1bmN0aW9uIG9uUHJldmlldyhmaWxlKSB7CiAgICAgICAgICBpZiAoX3RoaXMuX2VsUHJvcHMubGlzdFR5cGUgPT09ICdwaWN0dXJlLWNhcmQnIHx8IF90aGlzLl9lbFByb3BzLmxpc3RUeXBlID09PSAncGljdHVyZScgfHwgX3RoaXMuX2VsUHJvcHMubGlzdFR5cGUgPT09ICdhdmF0YXInKSB7CiAgICAgICAgICAgIF90aGlzLmRpYWxvZ0ltYWdlVXJsID0gZmlsZS51cmw7CiAgICAgICAgICAgIF90aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2luZG93Lm9wZW4oZmlsZS51cmwpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgYmVmb3JlVXBsb2FkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgX2JlZm9yZVVwbG9hZCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShmaWxlKSB7CiAgICAgICAgICAgIHZhciByZXQsIGxpbWl0LCBzaG93TWVzc2FnZTsKICAgICAgICAgICAgcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5iZWZvcmVVcGxvYWQpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmJlZm9yZVVwbG9hZChmaWxlLCB7CiAgICAgICAgICAgICAgICAgICAgdm06IF90aGlzCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICByZXQgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgICBpZiAoIShyZXQgPT09IGZhbHNlKSkgewogICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICBpZiAoIShfdGhpcy5zaXplTGltaXQgPT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gODsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgbGltaXQgPSBfdGhpcy5zaXplTGltaXQ7CiAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsaW1pdCA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgICAgICBsaW1pdCA9IF90aGlzLnNpemVMaW1pdDsKICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSA9IGZ1bmN0aW9uIHNob3dNZXNzYWdlKGZpbGVTaXplLCBsaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLiRtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW1pdFRpcCA9IF90aGlzLmNvbXB1dGVGaWxlU2l6ZShsaW1pdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlU2l6ZVRpcCA9IF90aGlzLmNvbXB1dGVGaWxlU2l6ZShmaWxlLnNpemUpOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+aWh+S7tuWkp+Wwj+S4jeiDvei2hei/hycgKyBsaW1pdFRpcCArICfvvIzlvZPliY3mlofku7blpKflsI86JyArIGZpbGVTaXplVGlwLAogICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxpbWl0ID0gX3RoaXMuc2l6ZUxpbWl0LmxpbWl0OwogICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlID0gX3RoaXMuc2l6ZUxpbWl0LnRpcDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIShmaWxlLnNpemUgPiBsaW1pdCkpIHsKICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgbG9nLmRlYnVnKCfmlofku7blpKflsI/otoXov4fpmZDliLbvvJonLCBmaWxlLnNpemUpOwogICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZShmaWxlLnNpemUsIGxpbWl0KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwogICAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgIH0pKTsKICAgICAgICAgIGZ1bmN0aW9uIGJlZm9yZVVwbG9hZChfeCkgewogICAgICAgICAgICByZXR1cm4gX2JlZm9yZVVwbG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGJlZm9yZVVwbG9hZDsKICAgICAgICB9KCkKICAgICAgfTsKICAgIH0sCiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodmFsdWUpIHsKICAgICAgdGhpcy5pbml0VmFsdWUodmFsdWUpOwogICAgICAvLyB0aGlzLiRlbWl0KCdjaGFuZ2UnLCB0aGlzLmZpbGVMaXN0KQogICAgfSwKICAgIGdldFVwbG9hZGVyOiBmdW5jdGlvbiBnZXRVcGxvYWRlcigpIHsKICAgICAgdmFyIHR5cGUgPSB0aGlzLnR5cGU7CiAgICAgIGlmICh0aGlzLnVwbG9hZGVyICE9IG51bGwgJiYgdGhpcy51cGxvYWRlci50eXBlICE9IG51bGwpIHsKICAgICAgICB0eXBlID0gdGhpcy51cGxvYWRlci50eXBlOwogICAgICB9CiAgICAgIHJldHVybiBEMnBVcGxvYWRlci5nZXRVcGxvYWRlcih0eXBlKTsKICAgIH0sCiAgICBpbml0VmFsdWU6IGZ1bmN0aW9uIGluaXRWYWx1ZSh2YWx1ZSkgewogICAgICB2YXIgZmlsZUxpc3QgPSBbXTsKICAgICAgaWYgKHZhbHVlID09IG51bGwpIHt9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBpZiAodmFsdWUgIT09ICcnKSB7CiAgICAgICAgICB2YXIgZmlsZU5hbWUgPSB2YWx1ZS5zdWJzdHJpbmcodmFsdWUubGFzdEluZGV4T2YoJy8nKSArIDEpOwogICAgICAgICAgZmlsZUxpc3QgPSBbewogICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgIG5hbWU6IGZpbGVOYW1lCiAgICAgICAgICB9XTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiAwICYmIHR5cGVvZiB2YWx1ZVswXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHZhciB0bXAgPSBbXTsKICAgICAgICAgIHZhbHVlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gaXRlbS5zdWJzdHJpbmcoaXRlbS5sYXN0SW5kZXhPZignLycpICsgMSk7CiAgICAgICAgICAgIHRtcC5wdXNoKHsKICAgICAgICAgICAgICB2YWx1ZTogaXRlbSwKICAgICAgICAgICAgICBuYW1lOiBmaWxlTmFtZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgZmlsZUxpc3QgPSB0bXA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZpbGVMaXN0ID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgZmlsZUxpc3QgPSBbdmFsdWVdOwogICAgICB9CiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihmaWxlTGlzdCksCiAgICAgICAgX3N0ZXA7CiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciBpdGVtID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICBpZiAoaXRlbS52YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIGl0ZW0udmFsdWUgPSBpdGVtLnVybDsKICAgICAgICAgIH0KICAgICAgICAgIGl0ZW0udXJsID0gdGhpcy5idWlsZFVybChpdGVtLnZhbHVlLCBpdGVtKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgfQogICAgICB0aGlzLnJlc2V0RmlsZUxpc3QoZmlsZUxpc3QpOwogICAgfSwKICAgIGNvbXB1dGVGaWxlU2l6ZTogZnVuY3Rpb24gY29tcHV0ZUZpbGVTaXplKGZpbGVTaXplKSB7CiAgICAgIHZhciBzaXplVGlwID0gZmlsZVNpemU7CiAgICAgIGlmIChmaWxlU2l6ZSA+IDEwMjQgKiAxMDI0ICogMTAyNCkgewogICAgICAgIHNpemVUaXAgPSAoZmlsZVNpemUgLyAoMTAyNCAqIDEwMjQgKiAxMDI0KSkudG9GaXhlZCgyKSArICdHJzsKICAgICAgfSBlbHNlIGlmIChmaWxlU2l6ZSA+IDEwMjQgKiAxMDI0KSB7CiAgICAgICAgc2l6ZVRpcCA9IChmaWxlU2l6ZSAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMikgKyAnTSc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2l6ZVRpcCA9IE1hdGgucm91bmQoZmlsZVNpemUgLyAxMDI0KSArICdLJzsKICAgICAgfQogICAgICByZXR1cm4gc2l6ZVRpcDsKICAgIH0sCiAgICByZXNldEZpbGVMaXN0OiBmdW5jdGlvbiByZXNldEZpbGVMaXN0KGZpbGVMaXN0KSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLCAnZmlsZUxpc3QnLCBmaWxlTGlzdCk7CiAgICB9LAogICAgaGFuZGxlVXBsb2FkUHJvZ3Jlc3M6IGZ1bmN0aW9uIGhhbmRsZVVwbG9hZFByb2dyZXNzKGV2ZW50LCBmaWxlLCBmaWxlTGlzdCkgewogICAgICBpZiAodGhpcy5fZWxQcm9wcy5saXN0VHlwZSA9PT0gJ2F2YXRhcicpIHsKICAgICAgICBsb2cuZGVidWcoJ3Byb2dyZXNzJywgZXZlbnQsIGZpbGUpOwogICAgICAgIHRoaXMuYXZhdGFyTG9hZGluZyA9IE1hdGguZmxvb3IoZXZlbnQucGVyY2VudCk7CiAgICAgICAgaWYgKGV2ZW50LnBlcmNlbnQgPT09IDEwMCkgewogICAgICAgICAgdGhpcy5hdmF0YXJMb2FkaW5nID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLiRlbWl0KCdwcm9ncmVzcycsIGV2ZW50LCB7CiAgICAgICAgZmlsZTogZmlsZSwKICAgICAgICBmaWxlTGlzdDogZmlsZUxpc3QsCiAgICAgICAgdm06IHRoaXMKICAgICAgfSk7CiAgICB9LAogICAgaGFuZGxlVXBsb2FkRmlsZVN1Y2Nlc3M6IGZ1bmN0aW9uIGhhbmRsZVVwbG9hZEZpbGVTdWNjZXNzKHJlcywgZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgcmVzLnNpemUgPSByZXMuc2l6ZSAhPSBudWxsID8gcmVzLnNpemUgOiBmaWxlLnNpemU7CiAgICAgIHJlcy5uYW1lID0gcmVzLm5hbWUgIT0gbnVsbCA/IHJlcy5uYW1lIDogZmlsZS5uYW1lOwogICAgICByZXMudmFsdWUgPSB0aGlzLmdldFJldHVyblZhbHVlKHJlcyk7CiAgICAgIHZhciB2YWx1ZSA9IHRoaXMucmV0dXJuVHlwZSA9PT0gJ29iamVjdCcgPyByZXMudXJsIDogcmVzLnZhbHVlOwogICAgICB2YXIgdXJsID0gdGhpcy5idWlsZFVybCh2YWx1ZSwgcmVzKTsKICAgICAgZmlsZS51cmwgPSByZXMudXJsID0gdXJsOwogICAgICB0aGlzLnJlc2V0RmlsZUxpc3QoZmlsZUxpc3QpOwogICAgICB0aGlzLiRlbWl0KCdzdWNjZXNzJywgcmVzLCBmaWxlKTsKICAgICAgdmFyIGxpc3QgPSBbXTsKICAgICAgdmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihmaWxlTGlzdCksCiAgICAgICAgX3N0ZXAyOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgaXRlbSA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgIC8vIGlmIChpdGVtLnN0YXR1cyA9PT0gJ3VwbG9hZGluZycpIHsKICAgICAgICAgIC8vICAgbG9nLmRlYnVnKCflvZPliY3mlofku7bkuIrkvKDlrozmiJDvvIznrYnlvoXliankuIvnmoTmlofku7blhajpg6jkuIrkvKDmiJDlip/lkI7lho3mm7TmlrB2YWx1ZScpCiAgICAgICAgICAvLyAgIHJldHVybgogICAgICAgICAgLy8gfQogICAgICAgICAgaWYgKGl0ZW0ucmVzcG9uc2UgIT0gbnVsbCAmJiBpdGVtLnJlc3BvbnNlLnVybCAhPSBudWxsKSB7CiAgICAgICAgICAgIGxpc3QucHVzaChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtLnJlc3BvbnNlKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaXN0LnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IyLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IyLmYoKTsKICAgICAgfQogICAgICBsb2cuZGVidWcoJ2hhbmRsZVVwbG9hZEZpbGVTdWNjZXNzIGxpc3QnLCBsaXN0LCByZXMpOwogICAgICB0aGlzLmVtaXQocmVzLCBsaXN0KTsKICAgIH0sCiAgICBpc0hhc1VwbG9hZGluZ0l0ZW06IGZ1bmN0aW9uIGlzSGFzVXBsb2FkaW5nSXRlbSgpIHsKICAgICAgdmFyIGZpbGVMaXN0ID0gdGhpcy4kcmVmcy5maWxlVXBsb2FkZXIudXBsb2FkRmlsZXM7CiAgICAgIGlmIChmaWxlTGlzdCAmJiBmaWxlTGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIF9pdGVyYXRvcjMgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihmaWxlTGlzdCksCiAgICAgICAgICBfc3RlcDM7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgIHZhciBpdGVtID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICBpZiAoaXRlbS5zdGF0dXMgPT09ICd1cGxvYWRpbmcnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9pdGVyYXRvcjMuZShlcnIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBfaXRlcmF0b3IzLmYoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGhhbmRsZVVwbG9hZEZpbGVSZW1vdmU6IGZ1bmN0aW9uIGhhbmRsZVVwbG9hZEZpbGVSZW1vdmUoZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgdGhpcy5maWxlTGlzdCA9IGZpbGVMaXN0OwogICAgICBjb25zb2xlLmxvZygncmVtb3ZlJywgZmlsZUxpc3QpOwogICAgICB0aGlzLmVtaXRMaXN0KGZpbGVMaXN0KTsKICAgICAgdGhpcy4kZW1pdCgncmVtb3ZlJywgZmlsZSwgZmlsZUxpc3QpOwogICAgfSwKICAgIGhhbmRsZVVwbG9hZEZpbGVFcnJvcjogZnVuY3Rpb24gaGFuZGxlVXBsb2FkRmlsZUVycm9yKGVyciwgZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgY29uc29sZS5lcnJvcign5paH5Lu25LiK5Lyg5aSx6LSlJywgZXJyLCBmaWxlLCBmaWxlTGlzdCk7CiAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgIHR5cGU6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogJ+aWh+S7tuS4iuS8oOWksei0pScKICAgICAgfSk7CiAgICAgIHRoaXMuJGVtaXQoJ2Vycm9yJywgZXJyLCBmaWxlLCBmaWxlTGlzdCk7CiAgICB9LAogICAgcHJldmlld0F2YXRhcjogZnVuY3Rpb24gcHJldmlld0F2YXRhcigkZXZlbnQpIHsKICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB0aGlzLl9lbFByb3BzLm9uUHJldmlldyh0aGlzLmZpbGVMaXN0WzBdKTsKICAgIH0sCiAgICByZW1vdmVBdmF0YXI6IGZ1bmN0aW9uIHJlbW92ZUF2YXRhcigkZXZlbnQpIHsKICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICB0aGlzLnJlc2V0RmlsZUxpc3QoW10pOwogICAgICB0aGlzLmVtaXQoKTsgLy8g6L+U5ZuedW5kZWZpbmVk77yM55u45b2T5LqO5riF56m65bey5pyJ55qE5YC8CiAgICB9LAogICAgZW1pdDogZnVuY3Rpb24gZW1pdChyZXMsIGxpc3QpIHsKICAgICAgaWYgKHRoaXMuX2VsUHJvcHMubGltaXQgPT09IDEpIHsKICAgICAgICB2YXIgdmFsdWUgPSByZXMgPyByZXMudmFsdWUgOiB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5lbWl0VmFsdWUgPSB2YWx1ZTsKICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVtaXRMaXN0KGxpc3QpOwogICAgICB9CiAgICB9LAogICAgZW1pdExpc3Q6IGZ1bmN0aW9uIGVtaXRMaXN0KGxpc3QpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CiAgICAgIGlmIChsaXN0KSB7CiAgICAgICAgdmFyIHRtcCA9IFtdOwogICAgICAgIGxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdG1wLnB1c2goX3RoaXMyLmdldFJldHVyblZhbHVlKGl0ZW0pKTsKICAgICAgICB9KTsKICAgICAgICBsaXN0ID0gdG1wOwogICAgICB9CiAgICAgIHRoaXMuZW1pdFZhbHVlID0gbGlzdDsKICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBsaXN0KTsKICAgIH0sCiAgICBnZXRSZXR1cm5WYWx1ZTogZnVuY3Rpb24gZ2V0UmV0dXJuVmFsdWUoaXRlbSkgewogICAgICB2YXIgdmFsdWUgPSBpdGVtW3RoaXMucmV0dXJuVHlwZV07CiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CiAgICAgIHJldHVybiBpdGVtOwogICAgfSwKICAgIGh0dHBSZXF1ZXN0OiBmdW5jdGlvbiBodHRwUmVxdWVzdChvcHRpb24pIHsKICAgICAgUHJvbWlzZS5hbGwoW3RoaXMuZG9VcGxvYWQob3B0aW9uKSwgdGhpcy5jb21wdXRlTWQ1KG9wdGlvbi5maWxlKV0pLnRoZW4oZnVuY3Rpb24gKHJldCkgewogICAgICAgIC8vIOW+l+WIsOe7hOWQiOe7k+aenO+8jCBzaXpl77yMbWQ1CiAgICAgICAgdmFyIHJlc3VsdCA9IHJldFswXTsKICAgICAgICByZXN1bHQubWQ1ID0gcmV0WzFdOwogICAgICAgIG9wdGlvbi5vblN1Y2Nlc3MocmVzdWx0KTsKICAgICAgfSk7CiAgICB9LAogICAgZG9VcGxvYWQ6IGZ1bmN0aW9uIGRvVXBsb2FkKG9wdGlvbikgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKICAgICAgdmFyIGNvbmZpZyA9IHRoaXMudXBsb2FkZXI7CiAgICAgIGlmIChjb25maWcgPT0gbnVsbCkgewogICAgICAgIGNvbmZpZyA9IHt9OwogICAgICB9CiAgICAgIGlmICghbG9kYXNoLmlzRW1wdHkodGhpcy5fZWxQcm9wcy5hY3Rpb24pKSB7CiAgICAgICAgY29uZmlnLmFjdGlvbiA9IHRoaXMuX2VsUHJvcHMuYWN0aW9uOwogICAgICB9CiAgICAgIGlmICghbG9kYXNoLmlzRW1wdHkodGhpcy5fZWxQcm9wcy5uYW1lKSkgewogICAgICAgIGNvbmZpZy5uYW1lID0gdGhpcy5fZWxQcm9wcy5uYW1lOwogICAgICB9CiAgICAgIGlmICghbG9kYXNoLmlzRW1wdHkodGhpcy5fZWxQcm9wcy5kYXRhKSkgewogICAgICAgIGNvbmZpZy5kYXRhID0gdGhpcy5fZWxQcm9wcy5kYXRhOwogICAgICB9CiAgICAgIGlmICghbG9kYXNoLmlzRW1wdHkodGhpcy5fZWxQcm9wcy5oZWFkZXJzKSkgewogICAgICAgIGNvbmZpZy5oZWFkZXJzID0gdGhpcy5fZWxQcm9wcy5oZWFkZXJzOwogICAgICB9CiAgICAgIGlmICghbG9kYXNoLmlzRW1wdHkodGhpcy5jdXN0b20pKSB7CiAgICAgICAgY29uZmlnLmN1c3RvbSA9IHRoaXMuY3VzdG9tOwogICAgICB9CiAgICAgIHZhciB1cGxvYWRPcHRpb24gPSB7CiAgICAgICAgZmlsZTogb3B0aW9uLmZpbGUsCiAgICAgICAgZmlsZU5hbWU6IG9wdGlvbi5maWxlLm5hbWUsCiAgICAgICAgb25Qcm9ncmVzczogb3B0aW9uLm9uUHJvZ3Jlc3MsCiAgICAgICAgb25FcnJvcjogb3B0aW9uLm9uRXJyb3IsCiAgICAgICAgY29uZmlnOiBjb25maWcKICAgICAgfTsKICAgICAgdGhpcy4kZW1pdCgnc3RhcnQnLCB1cGxvYWRPcHRpb24pOwogICAgICByZXR1cm4gdGhpcy5nZXRVcGxvYWRlcigpLnRoZW4oZnVuY3Rpb24gKHVwbG9hZGVyKSB7CiAgICAgICAgcmV0dXJuIHVwbG9hZGVyLnVwbG9hZCh1cGxvYWRPcHRpb24pOwogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXQpIHsKICAgICAgICBpZiAoX3RoaXMzLnN1ZmZpeCAhPSBudWxsKSB7CiAgICAgICAgICByZXQudXJsICs9IF90aGlzMy5zdWZmaXg7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0pOwogICAgfSwKICAgIG9uRXhjZWVkOiBmdW5jdGlvbiBvbkV4Y2VlZChmaWxlcywgZmlsZUxpc3QpIHsKICAgICAgbG9nLmRlYnVnKCfmlofku7bmlbDph4/otoXlh7rpmZDliLYnKTsKICAgICAgaWYgKHRoaXMuX2VsUHJvcHMubGltaXQgPT09IDEpIHsKICAgICAgICB0aGlzLmNsZWFyRmlsZXMoKTsKICAgICAgICB0aGlzLiRyZWZzLmZpbGVVcGxvYWRlci5oYW5kbGVTdGFydChmaWxlc1swXSk7CiAgICAgICAgdGhpcy4kcmVmcy5maWxlVXBsb2FkZXIuc3VibWl0KCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgIHNob3dDbG9zZTogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiAn5bey6L6+5pyA5aSn6ZmQ5Yi25pWw6YeP77yM6K+35Yig6Zmk5LiA5Liq5paH5Lu25ZCO5YaN5LiK5LygJywKICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgfSk7CiAgICB9LAogICAgY2xlYXJGaWxlczogZnVuY3Rpb24gY2xlYXJGaWxlcygpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMuZmlsZVVwbG9hZGVyICE9IG51bGwpIHsKICAgICAgICB0aGlzLiRyZWZzLmZpbGVVcGxvYWRlci5jbGVhckZpbGVzKCk7CiAgICAgIH0KICAgIH0sCiAgICBnZXRGaWxlTGlzdDogZnVuY3Rpb24gZ2V0RmlsZUxpc3QoKSB7CiAgICAgIHJldHVybiB0aGlzLmZpbGVMaXN0OwogICAgfSwKICAgIGNvbXB1dGVNZDU6IGZ1bmN0aW9uIGNvbXB1dGVNZDUoZmlsZSkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHZhciBibG9iU2xpY2UgPSBGaWxlLnByb3RvdHlwZS5zbGljZSB8fCBGaWxlLnByb3RvdHlwZS5tb3pTbGljZSB8fCBGaWxlLnByb3RvdHlwZS53ZWJraXRTbGljZTsKICAgICAgICB2YXIgY2h1bmtTaXplID0gMjA5NzE1MjsgLy8gUmVhZCBpbiBjaHVua3Mgb2YgMk1CCiAgICAgICAgdmFyIGNodW5rcyA9IE1hdGguY2VpbChmaWxlLnNpemUgLyBjaHVua1NpemUpOwogICAgICAgIHZhciBjdXJyZW50Q2h1bmsgPSAwOwogICAgICAgIHZhciBzcGFyayA9IG5ldyBTcGFya01ENS5BcnJheUJ1ZmZlcigpOwogICAgICAgIHZhciBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBzcGFyay5hcHBlbmQoZS50YXJnZXQucmVzdWx0KTsgLy8gQXBwZW5kIGFycmF5IGJ1ZmZlcgogICAgICAgICAgY3VycmVudENodW5rKys7CiAgICAgICAgICBpZiAoY3VycmVudENodW5rIDwgY2h1bmtzKSB7CiAgICAgICAgICAgIGxvYWROZXh0KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbWQ1ID0gc3BhcmsuZW5kKCk7CiAgICAgICAgICAgIGxvZy5kZWJ1ZygnY29tcHV0ZWQgaGFzaCcsIG1kNSk7IC8vIENvbXB1dGUgaGFzaAoKICAgICAgICAgICAgcmVzb2x2ZShtZDUpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZmlsZVJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLXByb21pc2UtcmVqZWN0LWVycm9ycwogICAgICAgICAgcmVqZWN0KCdtZDUgY29tcHV0ZXIgZXJyb3InLCBlcnJvcik7CiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBsb2FkTmV4dCgpIHsKICAgICAgICAgIHZhciBzdGFydCA9IGN1cnJlbnRDaHVuayAqIGNodW5rU2l6ZTsKICAgICAgICAgIHZhciBlbmQgPSBzdGFydCArIGNodW5rU2l6ZSA+PSBmaWxlLnNpemUgPyBmaWxlLnNpemUgOiBzdGFydCArIGNodW5rU2l6ZTsKICAgICAgICAgIGZpbGVSZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYlNsaWNlLmNhbGwoZmlsZSwgc3RhcnQsIGVuZCkpOwogICAgICAgIH0KICAgICAgICBsb2FkTmV4dCgpOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"mappings":";;;;;;;;;;;;;AAgDA;AACA;AACA;AACA;AACA;AACA;AACA;EACAA;EACAC;EACAC;IACA;IACAC;MAAAC;IAAA;IACA;IACAC;MAAAD;IAAA;IACA;IACAE;IACA;IACAC;MACAA;MACAH;IACA;;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAI;MACAD;IACA;IACA;IACAE;MACAF;MACAG;IACA;IACA;IACAC;MACAJ;MACAH;IACA;IACA;IACAQ;MACAL;IACA;IACA;IACA;IACAM;MACAN;IACA;IACA;IACAO;MACAP;IACA;IACA;IACA;IACAQ;MACAR;MAAAS;IACA;IACA;IACAC;MACAV;MACAH;QAAA;MAAA;IACA;IACA;IACAc;MACAX;MACAH;QAAA;MAAA;IACA;IACA;IACAe;MACAZ;IACA;EACA;EACAa;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACA;EACA;EACAC;IACAnB;MACA;QACA;MACA;MACA;MACA;QACA;MACA;MACA;MACA;IACA;EACA;EACAoB;IACAC;MACA;MACAb;MACA;IACA;IACAc;MACA;QACA;QACAC;QACA;UACA;QACA;UACA;QACA;MACA;MACA;IACA;IACAC;MACA;QACA;MACA;QACA;UACA;QACA;QACA;MACA;MACA;IACA;EACA;EACAC;IACAC;MACAC;IACA;IACAC;MAAA;MACA;QACAC;QACAC;QACAC;QACAC;QACAC;UACA;YACA;YACA;UACA;YACAC;UACA;QACA;QACAvB;UAAA;YAAA;YAAA;cAAA;gBAAA;kBAAA,KACA;oBAAA;oBAAA;kBAAA;kBAAA;kBAAA,OACA;oBAAAwB;kBAAA;gBAAA;kBAAAC;kBAAA,MACAA;oBAAA;oBAAA;kBAAA;kBAAA;gBAAA;kBAAA,MAIA;oBAAA;oBAAA;kBAAA;kBAAA,iCACA;gBAAA;kBAEAP;kBACAQ;kBACA;oBACAR;oBACAQ;sBACA;wBACA;wBACA;wBACA;0BAAAC;0BAAAvC;wBAAA;sBACA;oBACA;kBACA;oBACA8B;oBACAQ;kBACA;kBAAA,MACAE;oBAAA;oBAAA;kBAAA;kBACAhB;kBACAc;kBAAA,iCACA;gBAAA;gBAAA;kBAAA;cAAA;YAAA;UAAA,CAEA;UAAA;YAAA;UAAA;UAAA;QAAA;MACA;IACA;IACAG;MACA;MACA;IACA;IACAC;MACA;MACA;QACA1C;MACA;MACA;IACA;IACA2C;MACA;MACA,oBAEA;QACA;UACA;UACA7B;YAAAb;YAAAR;UAAA;QACA;MACA;QACA;UACA;UACAQ;YACA;YACA2C;cAAA3C;cAAAR;YAAA;UACA;UACAqB;QACA;UACAA;QACA;MACA;QACAA;MACA;MAAA,2CACAA;QAAA;MAAA;QAAA;UAAA;UACA;YACA+B;UACA;UACAA;QACA;MAAA;QAAA;MAAA;QAAA;MAAA;MACA;IACA;IACAC;MACA;MACA;QACAC;MACA;QACAA;MACA;QACAA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;QACAzB;QACA;QACA;UACA;QACA;MACA;MACA;QAAAgB;QAAA1B;QAAAsB;MAAA;IACA;IACAc;MACAC;MACAA;MACAA;MACA;MACA;MACAX;MACA;MACA;MACA;MAAA,4CACA1B;QAAA;MAAA;QAAA;UAAA;UACA;UACA;UACA;UACA;UACA;YACAsC;UACA;YACAA;UACA;QACA;MAAA;QAAA;MAAA;QAAA;MAAA;MACA5B;MACA;IACA;IACA6B;MACA;MACA;QAAA,4CACAvC;UAAA;QAAA;UAAA;YAAA;YACA;cACA;YACA;UACA;QAAA;UAAA;QAAA;UAAA;QAAA;MACA;MACA;IACA;IACAwC;MACA;MACA1B;MACA;MACA;IACA;IACA2B;MACA3B;MACA;QAAA5B;QAAAuC;MAAA;MACA;IACA;IACAiB;MACAC;MACA;IACA;IACAC;MACAD;MACA;MACA;IACA;IACAE;MACA;QACA;QACA;QACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MACA;QACA;QACAR;UACAR;QACA;QACAQ;MACA;MACA;MACA;IACA;IACAS;MACA;MACA;QACA;MACA;MACA;IACA;IACAC;MACAC,aACA,uBACA,6BACA;QACA;QACA;QACAC;QACAC;MACA;IACA;IACAC;MAAA;MACA;MACA;QACAC;MACA;MACA;QACAA;MACA;MACA;QACAA;MACA;MACA;QACAA;MACA;MACA;QACAA;MACA;MACA;QACAA;MACA;MACA;QACA3B;QACA4B;QACAC;QACAC;QACAH;MACA;MACA;MACA;QACA;MACA;QACA;UACA9B;QACA;QACA;MACA;IACA;IACAkC;MACA/C;MACA;QACA;QACA;QACA;QACA;MACA;MACA;QACAgD;QACAjC;QACAvC;MACA;IACA;IACAyE;MACA;QACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;QACA;QACA;QACA;QACA;QACA;QACA;QAEAC;UACAC;UACAC;UAEA;YACAC;UACA;YACA;YACAvD;;YAEAwD;UACA;QACA;QAEAJ;UACA;UACAK;QACA;QAEA;UACA;UACA;UAEAL;QACA;QAEAG;MACA;IACA;EACA;AACA","names":["name","mixins","props","btnSize","default","btnName","accept","type","value","suffix","required","returnType","custom","elProps","preview","sizeLimit","Object","buildUrl","uploader","beforeUpload","data","fileList","context","dialogImageUrl","dialogVisible","avatarLoading","created","watch","computed","_elProps","avatarUrl","log","uploadClass","methods","handleBlur","console","getDefaultElProps","limit","listType","showFileList","action","onPreview","window","vm","ret","showMessage","message","file","setValue","getUploader","initValue","tmp","item","computeFileSize","sizeTip","resetFileList","handleUploadProgress","handleUploadFileSuccess","res","list","isHasUploadingItem","handleUploadFileRemove","handleUploadFileError","previewAvatar","$event","removeAvatar","emit","emitList","getReturnValue","httpRequest","Promise","result","option","doUpload","config","fileName","onProgress","onError","onExceed","showClose","clearFiles","getFileList","computeMd5","fileReader","spark","currentChunk","loadNext","resolve","reject"],"sourceRoot":"node_modules/d2p-extends/src/file-uploader/lib","sources":["file-uploader.vue"],"sourcesContent":["<template>\r\n  <div class=\"d2p-file-uploader\" :class=\"{'is-disabled':disabled}\" >\r\n  <el-upload :class=\"uploadClass\"\r\n             :file-list=\"fileList\"\r\n             :disabled=\"disabled\"\r\n             :http-request=\"httpRequest\"\r\n             :on-exceed=\"onExceed\"\r\n             :on-remove=\"handleUploadFileRemove\"\r\n             :on-success=\"handleUploadFileSuccess\"\r\n             :on-error=\"handleUploadFileError\"\r\n             :on-progress=\"handleUploadProgress\"\r\n             @blur=\"handleBlur\"\r\n             ref=\"fileUploader\"\r\n             v-bind=\"_elProps\"\r\n  >\r\n    <el-button :disabled=\"disabled\" :size=\"btnSize\" type=\"primary\" v-if=\"_elProps.listType === 'text' || this._elProps.listType === 'picture'\">{{btnName}}</el-button>\r\n    <div class=\"avatar-item-wrapper\"  v-else-if=\"this._elProps.listType === 'picture-card'\">\r\n      <i class=\"el-icon-plus avatar-uploader-icon\" />\r\n    </div>\r\n    <template v-else-if=\"_elProps.listType ===  'avatar'\">\r\n      <div class=\"avatar-item-wrapper\">\r\n        <div class=\"status-uploading\" v-if=\"avatarLoading!=null\">\r\n          <el-progress type=\"circle\" :percentage=\"avatarLoading\" :width=\"70\"/>\r\n        </div>\r\n        <div v-if=\"avatarUrl!=null\" class=\"avatar\">\r\n          <el-image :src=\"avatarUrl\">\r\n            <div slot=\"placeholder\" class=\"image-slot\">\r\n              <img src=\"./loading-spin.svg\">\r\n            </div>\r\n          </el-image>\r\n          <div class=\"preview\" @click.stop=\"\" >\r\n            <i class=\"el-icon-zoom-in\" @click=\"previewAvatar\"></i>\r\n            <i class=\"el-icon-delete\" v-if=\"!disabled\" @click=\"removeAvatar\"></i>\r\n          </div>\r\n        </div>\r\n        <i class=\"el-icon-plus avatar-uploader-icon\" v-else/>\r\n      </div>\r\n    </template>\r\n  </el-upload>\r\n    <el-dialog :visible.sync=\"dialogVisible\"  v-bind=\"preview\" append-to-body >\r\n      <div style=\"text-align: center\">\r\n        <img  style=\"max-width: 100%;\" :src=\"dialogImageUrl\" alt=\"\">\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport SparkMD5 from 'spark-md5'\r\nimport D2pUploader from '../../uploader'\r\nimport lodash from 'lodash'\r\nimport { d2CrudPlus } from '../../utils/d2-crud-plus'\r\nimport log from '../../utils/util.log'\r\n// 文件上传组件,依赖D2pUploader\r\nexport default {\r\n  name: 'd2p-file-uploader',\r\n  mixins: [d2CrudPlus.inputBase],\r\n  props: {\r\n    // 选择文件按钮的大小\r\n    btnSize: { default: 'small' },\r\n    // 选择文件按钮的名称\r\n    btnName: { default: '选择文件' },\r\n    // 可选哪些类型的文件\r\n    accept: {},\r\n    // 上传后端类型，[cos,qiniu,alioss,form]\r\n    type: {\r\n      type: String,\r\n      default: undefined // 上传类型：form cos qiniu  alioss\r\n    },\r\n    // 值：url<br/>\r\n    // 或 [url1,url2]<br/>\r\n    // 或 {url:'url',md5:'',size:number}<br/>\r\n    // 或 [{url:'url',md5:'',size:number}]<br/>\r\n    // <br/>\r\n    // limit=1 时 input事件返回 {url:'url',md5:'',size:number}<br/>\r\n    // limit>1 时 input事件返回 数组<br/>\r\n    value: {\r\n      type: [String, Array, Object]\r\n    },\r\n    // 样式后缀 追加到url的后面，进行图片处理，需要到对象存储平台配置样式\r\n    suffix: {\r\n      type: String,\r\n      required: false\r\n    },\r\n    // 返回类型: url=仅返回链接, object=包含md5和size , key=仅返回文件key\r\n    returnType: {\r\n      type: String,\r\n      default: 'url'\r\n    },\r\n    // 自定义参数\r\n    custom: {\r\n      type: Object\r\n    },\r\n    // 内部封装[el-upload](https://element.eleme.cn/#/zh-CN/component/upload)组件的属性参数<br/>\r\n    // 注意，form方式上传的action、name、headers等参数不在此设置\r\n    elProps: {\r\n      type: Object\r\n    },\r\n    // 预览对话框的配置\r\n    preview: {\r\n      type: Object\r\n    },\r\n    // 文件大小限制 <br/>\r\n    // 如果传入{limit,tip(fileSize,limit){vm.$message('可以自定义提示')}}\r\n    sizeLimit: {\r\n      type: Number, Object\r\n    },\r\n    // 构建下载url方法\r\n    buildUrl: {\r\n      type: Function,\r\n      default: function (value, item) { return (typeof value === 'object') ? item.url : value }\r\n    },\r\n    // 上传组件参数，会临时覆盖全局上传配置参数[d2p-uploader](/guide/extends/uploader.html)\r\n    uploader: {\r\n      type: Object,\r\n      default () { return {} }\r\n    },\r\n    // 与el-upload一致\r\n    beforeUpload: {\r\n      type: Function\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      fileList: [],\r\n      context: {},\r\n      dialogImageUrl: '',\r\n      dialogVisible: false,\r\n      avatarLoading: undefined\r\n    }\r\n  },\r\n  created () {\r\n    this.emitValue = this.value\r\n    this.initValue(this.value)\r\n  },\r\n  watch: {\r\n    value (value) {\r\n      if (this.dispatch) {\r\n        this.dispatch('ElFormItem', 'el.form.blur')\r\n      }\r\n      this.$emit('change', value)\r\n      if (this.emitValue === value) {\r\n        return\r\n      }\r\n      this.emitValue = value\r\n      this.initValue(value)\r\n    }\r\n  },\r\n  computed: {\r\n    _elProps () {\r\n      const defaultElProps = this.getDefaultElProps()\r\n      Object.assign(defaultElProps, this.elProps)\r\n      return defaultElProps\r\n    },\r\n    avatarUrl () {\r\n      if (this.fileList.length > 0) {\r\n        const file = this.fileList[0]\r\n        log.debug('file,', file, file.status)\r\n        if (file.response != null && file.response.url != null) {\r\n          return file.response.url\r\n        } else if (file.url != null) {\r\n          return file.url\r\n        }\r\n      }\r\n      return null\r\n    },\r\n    uploadClass () {\r\n      if (this._elProps.listType === 'avatar') {\r\n        return 'avatar-uploader'\r\n      } else if (this._elProps.listType === 'picture-card') {\r\n        if (this.fileList && this._elProps.limit !== 0 && this.fileList.length >= this._elProps.limit) {\r\n          return 'image-uploader hide-plus'\r\n        }\r\n        return 'image-uploader'\r\n      }\r\n      return 'file-uploader'\r\n    }\r\n  },\r\n  methods: {\r\n    handleBlur () {\r\n      console.log('blur')\r\n    },\r\n    getDefaultElProps () {\r\n      return {\r\n        limit: 0,\r\n        listType: 'text',\r\n        showFileList: true,\r\n        action: '',\r\n        onPreview: (file) => {\r\n          if (this._elProps.listType === 'picture-card' || this._elProps.listType === 'picture' || this._elProps.listType === 'avatar') {\r\n            this.dialogImageUrl = file.url\r\n            this.dialogVisible = true\r\n          } else {\r\n            window.open(file.url)\r\n          }\r\n        },\r\n        beforeUpload: async (file) => {\r\n          if (this.beforeUpload) {\r\n            const ret = await this.beforeUpload(file, { vm: this })\r\n            if (ret === false) {\r\n              return\r\n            }\r\n          }\r\n          if (this.sizeLimit == null) {\r\n            return true\r\n          }\r\n          let limit = this.sizeLimit\r\n          let showMessage = null\r\n          if (typeof limit === 'number') {\r\n            limit = this.sizeLimit\r\n            showMessage = (fileSize, limit) => {\r\n              if (this.$message) {\r\n                const limitTip = this.computeFileSize(limit)\r\n                const fileSizeTip = this.computeFileSize(file.size)\r\n                this.$message({ message: '文件大小不能超过' + limitTip + '，当前文件大小:' + fileSizeTip, type: 'warning' })\r\n              }\r\n            }\r\n          } else {\r\n            limit = this.sizeLimit.limit\r\n            showMessage = this.sizeLimit.tip\r\n          }\r\n          if (file.size > limit) {\r\n            log.debug('文件大小超过限制：', file.size)\r\n            showMessage(file.size, limit)\r\n            return false\r\n          }\r\n        }\r\n      }\r\n    },\r\n    setValue (value) {\r\n      this.initValue(value)\r\n      // this.$emit('change', this.fileList)\r\n    },\r\n    getUploader () {\r\n      let type = this.type\r\n      if (this.uploader != null && this.uploader.type != null) {\r\n        type = this.uploader.type\r\n      }\r\n      return D2pUploader.getUploader(type)\r\n    },\r\n    initValue (value) {\r\n      let fileList = []\r\n      if (value == null) {\r\n\r\n      } else if (typeof (value) === 'string') {\r\n        if (value !== '') {\r\n          const fileName = value.substring(value.lastIndexOf('/') + 1)\r\n          fileList = [{ value: value, name: fileName }]\r\n        }\r\n      } else if (value instanceof Array) {\r\n        if (value.length > 0 && typeof (value[0]) === 'string') {\r\n          const tmp = []\r\n          value.forEach(item => {\r\n            const fileName = item.substring(item.lastIndexOf('/') + 1)\r\n            tmp.push({ value: item, name: fileName })\r\n          })\r\n          fileList = tmp\r\n        } else {\r\n          fileList = value\r\n        }\r\n      } else if (value instanceof Object) {\r\n        fileList = [value]\r\n      }\r\n      for (const item of fileList) {\r\n        if (item.value == null) {\r\n          item.value = item.url\r\n        }\r\n        item.url = this.buildUrl(item.value, item)\r\n      }\r\n      this.resetFileList(fileList)\r\n    },\r\n    computeFileSize (fileSize) {\r\n      let sizeTip = fileSize\r\n      if (fileSize > (1024 * 1024 * 1024)) {\r\n        sizeTip = (fileSize / (1024 * 1024 * 1024)).toFixed(2) + 'G'\r\n      } else if (fileSize > (1024 * 1024)) {\r\n        sizeTip = (fileSize / (1024 * 1024)).toFixed(2) + 'M'\r\n      } else {\r\n        sizeTip = Math.round(fileSize / (1024)) + 'K'\r\n      }\r\n      return sizeTip\r\n    },\r\n    resetFileList (fileList) {\r\n      this.$set(this, 'fileList', fileList)\r\n    },\r\n    handleUploadProgress (event, file, fileList) {\r\n      if (this._elProps.listType === 'avatar') {\r\n        log.debug('progress', event, file)\r\n        this.avatarLoading = Math.floor(event.percent)\r\n        if (event.percent === 100) {\r\n          this.avatarLoading = undefined\r\n        }\r\n      }\r\n      this.$emit('progress', event, { file, fileList, vm: this })\r\n    },\r\n    handleUploadFileSuccess (res, file, fileList) {\r\n      res.size = res.size != null ? res.size : file.size\r\n      res.name = res.name != null ? res.name : file.name\r\n      res.value = this.getReturnValue(res)\r\n      const value = this.returnType === 'object' ? res.url : res.value\r\n      const url = this.buildUrl(value, res)\r\n      file.url = res.url = url\r\n      this.resetFileList(fileList)\r\n      this.$emit('success', res, file)\r\n      const list = []\r\n      for (const item of fileList) {\r\n        // if (item.status === 'uploading') {\r\n        //   log.debug('当前文件上传完成，等待剩下的文件全部上传成功后再更新value')\r\n        //   return\r\n        // }\r\n        if (item.response != null && item.response.url != null) {\r\n          list.push({ ...item.response })\r\n        } else {\r\n          list.push(item)\r\n        }\r\n      }\r\n      log.debug('handleUploadFileSuccess list', list, res)\r\n      this.emit(res, list)\r\n    },\r\n    isHasUploadingItem () {\r\n      const fileList = this.$refs.fileUploader.uploadFiles\r\n      if (fileList && fileList.length > 0) {\r\n        for (const item of fileList) {\r\n          if (item.status === 'uploading') {\r\n            return true\r\n          }\r\n        }\r\n      }\r\n      return false\r\n    },\r\n    handleUploadFileRemove (file, fileList) {\r\n      this.fileList = fileList\r\n      console.log('remove', fileList)\r\n      this.emitList(fileList)\r\n      this.$emit('remove', file, fileList)\r\n    },\r\n    handleUploadFileError (err, file, fileList) {\r\n      console.error('文件上传失败', err, file, fileList)\r\n      this.$message({ type: 'error', message: '文件上传失败' })\r\n      this.$emit('error', err, file, fileList)\r\n    },\r\n    previewAvatar ($event) {\r\n      $event.stopPropagation()\r\n      this._elProps.onPreview(this.fileList[0])\r\n    },\r\n    removeAvatar ($event) {\r\n      $event.stopPropagation()\r\n      this.resetFileList([])\r\n      this.emit() // 返回undefined，相当于清空已有的值\r\n    },\r\n    emit (res, list) {\r\n      if (this._elProps.limit === 1) {\r\n        const value = res ? res.value : undefined\r\n        this.emitValue = value\r\n        this.$emit('input', value)\r\n      } else {\r\n        this.emitList(list)\r\n      }\r\n    },\r\n    emitList (list) {\r\n      if (list) {\r\n        const tmp = []\r\n        list.forEach(item => {\r\n          tmp.push(this.getReturnValue(item))\r\n        })\r\n        list = tmp\r\n      }\r\n      this.emitValue = list\r\n      this.$emit('input', list)\r\n    },\r\n    getReturnValue (item) {\r\n      const value = item[this.returnType]\r\n      if (value != null) {\r\n        return value\r\n      }\r\n      return item\r\n    },\r\n    httpRequest (option) {\r\n      Promise.all([\r\n        this.doUpload(option),\r\n        this.computeMd5(option.file)\r\n      ]).then((ret) => {\r\n        // 得到组合结果， size，md5\r\n        const result = ret[0]\r\n        result.md5 = ret[1]\r\n        option.onSuccess(result)\r\n      })\r\n    },\r\n    doUpload (option) {\r\n      let config = this.uploader\r\n      if (config == null) {\r\n        config = {}\r\n      }\r\n      if (!lodash.isEmpty(this._elProps.action)) {\r\n        config.action = this._elProps.action\r\n      }\r\n      if (!lodash.isEmpty(this._elProps.name)) {\r\n        config.name = this._elProps.name\r\n      }\r\n      if (!lodash.isEmpty(this._elProps.data)) {\r\n        config.data = this._elProps.data\r\n      }\r\n      if (!lodash.isEmpty(this._elProps.headers)) {\r\n        config.headers = this._elProps.headers\r\n      }\r\n      if (!lodash.isEmpty(this.custom)) {\r\n        config.custom = this.custom\r\n      }\r\n      const uploadOption = {\r\n        file: option.file,\r\n        fileName: option.file.name,\r\n        onProgress: option.onProgress,\r\n        onError: option.onError,\r\n        config: config\r\n      }\r\n      this.$emit('start', uploadOption)\r\n      return this.getUploader().then(uploader => {\r\n        return uploader.upload(uploadOption)\r\n      }).then(ret => {\r\n        if (this.suffix != null) {\r\n          ret.url += this.suffix\r\n        }\r\n        return ret\r\n      })\r\n    },\r\n    onExceed (files, fileList) {\r\n      log.debug('文件数量超出限制')\r\n      if (this._elProps.limit === 1) {\r\n        this.clearFiles()\r\n        this.$refs.fileUploader.handleStart(files[0])\r\n        this.$refs.fileUploader.submit()\r\n        return\r\n      }\r\n      this.$message({\r\n        showClose: true,\r\n        message: '已达最大限制数量，请删除一个文件后再上传',\r\n        type: 'warning'\r\n      })\r\n    },\r\n    clearFiles () {\r\n      if (this.$refs.fileUploader != null) {\r\n        this.$refs.fileUploader.clearFiles()\r\n      }\r\n    },\r\n    getFileList () {\r\n      return this.fileList\r\n    },\r\n    computeMd5 (file) {\r\n      return new Promise((resolve, reject) => {\r\n        const blobSlice = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice\r\n        const chunkSize = 2097152 // Read in chunks of 2MB\r\n        const chunks = Math.ceil(file.size / chunkSize)\r\n        let currentChunk = 0\r\n        const spark = new SparkMD5.ArrayBuffer()\r\n        const fileReader = new FileReader()\r\n\r\n        fileReader.onload = (e) => {\r\n          spark.append(e.target.result) // Append array buffer\r\n          currentChunk++\r\n\r\n          if (currentChunk < chunks) {\r\n            loadNext()\r\n          } else {\r\n            const md5 = spark.end()\r\n            log.debug('computed hash', md5) // Compute hash\r\n\r\n            resolve(md5)\r\n          }\r\n        }\r\n\r\n        fileReader.onerror = function (error) {\r\n          // eslint-disable-next-line prefer-promise-reject-errors\r\n          reject('md5 computer error', error)\r\n        }\r\n\r\n        function loadNext () {\r\n          const start = currentChunk * chunkSize\r\n          const end = ((start + chunkSize) >= file.size) ? file.size : start + chunkSize\r\n\r\n          fileReader.readAsArrayBuffer(blobSlice.call(file, start, end))\r\n        }\r\n\r\n        loadNext()\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n  .d2p-file-uploader{\r\n    &.is-disabled{\r\n      .avatar-item-wrapper{\r\n        background-color: #F5F7FA;\r\n        border-color: #E4E7ED;\r\n        color: #C0C4CC;\r\n        cursor: not-allowed\r\n      }\r\n      li{\r\n        cursor: not-allowed\r\n      }\r\n      .el-upload-list__item-actions{\r\n        cursor: not-allowed\r\n      }\r\n    }\r\n    .hide-plus{\r\n      .el-upload--picture-card{\r\n        display: none;\r\n      }\r\n    }\r\n    .avatar-uploader{\r\n      display: flex;\r\n      .el-upload{\r\n        width: 100px;\r\n        height: 100px;\r\n        /*display: flex;*/\r\n        /*justify-content: center;*/\r\n        /*align-items: center;*/\r\n        background-color: #fbfdff;\r\n        border: 1px dashed #c0ccda;\r\n        border-radius: 6px;\r\n      }\r\n      .el-upload img{\r\n        max-width: 100px;\r\n        max-height: 100px;\r\n      }\r\n      .el-icon-plus.avatar-uploader-icon {\r\n        vertical-align: top;\r\n        font-size: 28px;\r\n        color: #8c939d;\r\n        line-height: 100px;\r\n      }\r\n      .status-uploading{\r\n        border-radius: 6px;\r\n        position: absolute;\r\n        width: 100%;\r\n        height: 100%;\r\n        left: 0;\r\n        top: 0;\r\n        cursor: default;\r\n        text-align: center;\r\n        color: #fff;\r\n        opacity: 1;\r\n        font-size: 20px;\r\n        background-color: rgba(0, 0, 0, 0.5);\r\n        -webkit-transition: opacity .3s;\r\n        transition: opacity .3s;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        .el-progress{\r\n          width: 70px;\r\n          height: 70px;\r\n          .el-progress__text {\r\n            color:#fff;\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n    .el-upload--picture-card .el-icon-plus.avatar-uploader-icon {\r\n      vertical-align: top;\r\n      font-size: 28px;\r\n      color: #8c939d;\r\n      line-height: 100px;\r\n    }\r\n    .image-uploader .el-upload-list--picture-card .el-upload-list__item-thumbnail {\r\n      max-width: 100%;\r\n      max-height: 100%;\r\n      width:auto;\r\n      height: auto;\r\n    }\r\n     .el-upload-list--picture .el-upload-list__item-thumbnail {\r\n      max-height: 100%;\r\n      height: auto;\r\n    }\r\n    .image-uploader .el-upload-list--picture-card .el-upload-list__item {\r\n      /*display: flex;*/\r\n      /*justify-content: center;*/\r\n      /*align-items: center;*/\r\n      text-align: center;\r\n      line-height: 125px;\r\n    }\r\n    .image-uploader{\r\n      /*display: flex;flex-wrap: wrap;*/\r\n      .el-upload-list--picture-card .el-upload-list__item-actions{\r\n        line-height: 100px;\r\n      }\r\n      .el-upload-list--picture-card {\r\n        /*display: flex;*/\r\n        /*flex-wrap: wrap;*/\r\n      }\r\n      .el-upload-list__item-status-label{\r\n        line-height: 1;\r\n      }\r\n    }\r\n\r\n    .el-upload--picture-card {\r\n      background-color: #fbfdff;\r\n      border: 1px dashed #c0ccda;\r\n      border-radius: 6px;\r\n      box-sizing: border-box;\r\n      width: 100px;\r\n      height: 100px;\r\n      cursor: pointer;\r\n      /*display: flex;*/\r\n      /*justify-content: center;*/\r\n      /*align-items: center;*/\r\n    }\r\n    .el-upload-list--picture-card {\r\n      .el-upload-list__item{\r\n        width: 100px;\r\n        height: 100px;\r\n      }\r\n      .el-progress-circle{\r\n        width: 70px !important;\r\n        height: 70px !important;\r\n      }\r\n      .el-progress{\r\n        width: 70px !important;\r\n        height: 70px !important;\r\n      }\r\n    }\r\n    .avatar-item-wrapper{\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      width: 100%;\r\n      height: 100%;\r\n      position: relative;\r\n      .avatar{\r\n        display: contents;\r\n      }\r\n    }\r\n\r\n    .preview{\r\n      border-radius: 6px;\r\n      position: absolute;\r\n      width: 100%;\r\n      height: 100%;\r\n      left: 0;\r\n      top: 0;\r\n      cursor: default;\r\n      text-align: center;\r\n      color: #fff;\r\n      opacity: 0;\r\n      font-size: 20px;\r\n      background-color: rgba(0,0,0,.9);\r\n      -webkit-transition: opacity .3s;\r\n      transition: opacity .3s;\r\n      &:hover{\r\n        opacity: 0.9;\r\n      }\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n      i{\r\n        margin: 0 7px;\r\n        cursor: pointer;\r\n      }\r\n    }\r\n  }\r\n\r\n</style>\r\n"]}]}