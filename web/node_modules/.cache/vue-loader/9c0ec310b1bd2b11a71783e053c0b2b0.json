{"remainingRequest":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/raviailani/Downloads/django-vue-admin/web/src/views/system/config/components/addContent.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/raviailani/Downloads/django-vue-admin/web/src/views/system/config/components/addContent.vue","mtime":1674694301490},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/babel-loader/lib/index.js","mtime":1674694549283},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js","mtime":1674694549360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCAqIGFzIGFwaSBmcm9tICcuLi9hcGknCmltcG9ydCBhc3NvY2lhdGlvblRhYmxlIGZyb20gJy4vY29tcG9uZW50cy9hc3NvY2lhdGlvblRhYmxlJwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdhZGRDb250ZW50JywKICBpbmplY3Q6IFsncmVmcmVzaFZpZXcnXSwKICBjb21wb25lbnRzOiB7CiAgICBhc3NvY2lhdGlvblRhYmxlCiAgfSwKICBkYXRhICgpIHsKICAgIHJldHVybiB7CiAgICAgIGZvcm06IHsKICAgICAgICBwYXJlbnQ6IG51bGwsCiAgICAgICAgdGl0bGU6IG51bGwsCiAgICAgICAga2V5OiBudWxsLAogICAgICAgIGZvcm1faXRlbV90eXBlOiBudWxsLAogICAgICAgIHJ1bGU6IG51bGwsCiAgICAgICAgcGxhY2Vob2xkZXI6IG51bGwKICAgICAgfSwKICAgICAgcnVsZXM6IHsKICAgICAgICBwYXJlbnQ6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6ICfor7fpgInmi6knCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICB0aXRsZTogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogJ+ivt+i+k+WFpScKICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgIGtleTogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogJ+ivt+i+k+WFpScKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIHBhdHRlcm46IC9eW0EtWmEtejAtOV9dKyQvLAogICAgICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5pWw5a2X44CB5a2X5q+N5oiW5LiL5YiS57q/JwogICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgZm9ybV9pdGVtX3R5cGU6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaUnCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9LAogICAgICAvLyDniLbnuqflhoXlrrkKICAgICAgcGFyZW50T3B0aW9uczogW10sCiAgICAgIHJ1bGVPcHRpb25zOiBbCiAgICAgICAgewogICAgICAgICAgbGFiZWw6ICflv4XloavpobknLAogICAgICAgICAgdmFsdWU6ICd7InJlcXVpcmVkIjogdHJ1ZSwgIm1lc3NhZ2UiOiAi5b+F5aGr6aG55LiN6IO95Li656m6In0nCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBsYWJlbDogJ+mCrueusScsCiAgICAgICAgICB2YWx1ZTogJ3sgInR5cGUiOiAiZW1haWwiLCAibWVzc2FnZSI6ICLor7fovpPlhaXmraPnoa7nmoTpgq7nrrHlnLDlnYAifScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGxhYmVsOiAnVVJM5Zyw5Z2AJywKICAgICAgICAgIHZhbHVlOiAneyAidHlwZSI6ICJ1cmwiLCAibWVzc2FnZSI6ICLor7fovpPlhaXmraPnoa7nmoRVUkzlnLDlnYAifScKICAgICAgICB9CiAgICAgIF0KICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGdldFBhcmVudCAoKSB7CiAgICAgIGFwaS5HZXRMaXN0KHsKICAgICAgICBwYXJlbnRfX2lzbnVsbDogdHJ1ZSwKICAgICAgICBsaW1pdDogOTk5CiAgICAgIH0pLnRoZW4ocmVzID0+IHsKICAgICAgICBjb25zdCB7IGRhdGEgfSA9IHJlcy5kYXRhCiAgICAgICAgdGhpcy5wYXJlbnRPcHRpb25zID0gZGF0YQogICAgICB9KQogICAgfSwKICAgIC8vIOaPkOS6pAogICAgb25TdWJtaXQgKCkgewogICAgICBjb25zdCB0aGF0ID0gdGhpcwogICAgICB0aGF0LmFzc29jaWF0aW9uVGFibGVVcGRhdGUoKS50aGVuKCgpID0+IHsKICAgICAgICBjb25zdCBmb3JtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGF0LmZvcm0pKQogICAgICAgIGNvbnN0IHJ1bGVzID0gW10KICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZm9ybS5ydWxlKSB7CiAgICAgICAgICBjb25zdCBzdHJUb09iaiA9IEpTT04ucGFyc2UoaXRlbSkKICAgICAgICAgIHJ1bGVzLnB1c2goc3RyVG9PYmopCiAgICAgICAgfQogICAgICAgIGZvcm0ucnVsZSA9IHJ1bGVzCiAgICAgICAgdGhhdC4kcmVmcy5mb3JtLnZhbGlkYXRlKCh2YWxpZCkgPT4gewogICAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICAgIGFwaS5jcmVhdGVPYmooZm9ybSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5paw5aKe5oiQ5YqfJykKICAgICAgICAgICAgICB0aGlzLnJlZnJlc2hWaWV3KCkKICAgICAgICAgICAgfSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvciBzdWJtaXQhIScpCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0pCiAgICB9LAogICAgLy8g5YWz6IGU6KGo5pWw5o2u5pu05pawCiAgICBhc3NvY2lhdGlvblRhYmxlVXBkYXRlICgpIHsKICAgICAgY29uc3QgdGhhdCA9IHRoaXMKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBpZiAodGhhdC4kcmVmcy5hc3NvY2lhdGlvblRhYmxlKSB7CiAgICAgICAgICBpZiAoIXRoYXQuJHJlZnMuYXNzb2NpYXRpb25UYWJsZS5vblN1Ym1pdCgpKSB7CiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItcHJvbWlzZS1yZWplY3QtZXJyb3JzCiAgICAgICAgICAgIHJldHVybiByZWplY3QoZmFsc2UpCiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB7IGZvcm1PYmogfSA9IHRoYXQuJHJlZnMuYXNzb2NpYXRpb25UYWJsZQogICAgICAgICAgdGhhdC5mb3JtLnNldHRpbmcgPSBmb3JtT2JqCiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0cnVlKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0cnVlKQogICAgICAgIH0KICAgICAgfSkKICAgIH0KICB9LAogIGNyZWF0ZWQgKCkgewogICAgdGhpcy5nZXRQYXJlbnQoKQogIH0KfQo="},{"version":3,"sources":["addContent.vue"],"names":[],"mappings":";AAoDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addContent.vue","sourceRoot":"src/views/system/config/components","sourcesContent":["<template>\n  <div style=\"padding: 20px\">\n    <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\n      <el-form-item label=\"所属分组\" prop=\"parent\">\n        <el-select v-model=\"form.parent\" placeholder=\"请选择分组\" clearable>\n          <el-option :label=\"item.title\" :value=\"item.id\" :key=\"index\"\n                     v-for=\"(item,index) in parentOptions\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"标题\" prop=\"title\">\n        <el-input v-model=\"form.title\" placeholder=\"请输入\" clearable></el-input>\n      </el-form-item>\n      <el-form-item label=\"key值\" prop=\"key\">\n        <el-input v-model=\"form.key\" placeholder=\"请输入\" clearable></el-input>\n      </el-form-item>\n      <el-form-item label=\"表单类型\" prop=\"form_item_type\">\n        <el-select v-model=\"form.form_item_type\" placeholder=\"请选择\" clearable>\n          <el-option :label=\"item.label\" :value=\"item.value\" :key=\"index\"\n                     v-for=\"(item,index) in dictionary('config_form_type')\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item\n        v-if=\"[4,5,6].indexOf(form.form_item_type)>-1\"\n        label=\"字典key\"\n        prop=\"setting\"\n        :rules=\"[{required: true,message: '不能为空'}]\">\n        <el-input v-model=\"form.setting\" placeholder=\"请输入dictionary中key值\" clearable></el-input>\n      </el-form-item>\n      <div v-if=\"[13,14].indexOf(form.form_item_type)>-1\">\n        <associationTable ref=\"associationTable\" v-model=\"form.setting\"\n                          @updateVal=\"associationTableUpdate\"></associationTable>\n      </div>\n      <el-form-item label=\"校验规则\">\n        <el-select v-model=\"form.rule\" multiple placeholder=\"请选择(可多选)\" clearable>\n          <el-option :label=\"item.label\" :value=\"item.value\" :key=\"index\"\n                     v-for=\"(item,index) in ruleOptions\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"提示信息\" prop=\"placeholder\">\n        <el-input v-model=\"form.placeholder\" placeholder=\"请输入\" clearable></el-input>\n      </el-form-item>\n      <el-form-item label=\"排序\" prop=\"sort\">\n        <el-input-number v-model=\"form.sort\" :min=\"0\" :max=\"99\"></el-input-number>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"onSubmit\">立即创建</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport * as api from '../api'\nimport associationTable from './components/associationTable'\n\nexport default {\n  name: 'addContent',\n  inject: ['refreshView'],\n  components: {\n    associationTable\n  },\n  data () {\n    return {\n      form: {\n        parent: null,\n        title: null,\n        key: null,\n        form_item_type: null,\n        rule: null,\n        placeholder: null\n      },\n      rules: {\n        parent: [\n          {\n            required: true,\n            message: '请选择'\n          }\n        ],\n        title: [\n          {\n            required: true,\n            message: '请输入'\n          }\n        ],\n        key: [\n          {\n            required: true,\n            message: '请输入'\n          },\n          {\n            pattern: /^[A-Za-z0-9_]+$/,\n            message: '请输入数字、字母或下划线'\n          }\n        ],\n        form_item_type: [\n          {\n            required: true,\n            message: '请输入'\n          }\n        ]\n      },\n      // 父级内容\n      parentOptions: [],\n      ruleOptions: [\n        {\n          label: '必填项',\n          value: '{\"required\": true, \"message\": \"必填项不能为空\"}'\n        },\n        {\n          label: '邮箱',\n          value: '{ \"type\": \"email\", \"message\": \"请输入正确的邮箱地址\"}'\n        },\n        {\n          label: 'URL地址',\n          value: '{ \"type\": \"url\", \"message\": \"请输入正确的URL地址\"}'\n        }\n      ]\n    }\n  },\n  methods: {\n    getParent () {\n      api.GetList({\n        parent__isnull: true,\n        limit: 999\n      }).then(res => {\n        const { data } = res.data\n        this.parentOptions = data\n      })\n    },\n    // 提交\n    onSubmit () {\n      const that = this\n      that.associationTableUpdate().then(() => {\n        const form = JSON.parse(JSON.stringify(that.form))\n        const rules = []\n        for (const item of form.rule) {\n          const strToObj = JSON.parse(item)\n          rules.push(strToObj)\n        }\n        form.rule = rules\n        that.$refs.form.validate((valid) => {\n          if (valid) {\n            api.createObj(form).then(res => {\n              this.$message.success('新增成功')\n              this.refreshView()\n            })\n          } else {\n            console.log('error submit!!')\n            return false\n          }\n        })\n      })\n    },\n    // 关联表数据更新\n    associationTableUpdate () {\n      const that = this\n      return new Promise(function (resolve, reject) {\n        if (that.$refs.associationTable) {\n          if (!that.$refs.associationTable.onSubmit()) {\n            // eslint-disable-next-line prefer-promise-reject-errors\n            return reject(false)\n          }\n          const { formObj } = that.$refs.associationTable\n          that.form.setting = formObj\n          return resolve(true)\n        } else {\n          return resolve(true)\n        }\n      })\n    }\n  },\n  created () {\n    this.getParent()\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}