{"remainingRequest":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/raviailani/Downloads/django-vue-admin/web/src/views/system/rolePermission/index.vue?vue&type=style&index=0&id=96250e44&lang=scss&","dependencies":[{"path":"/Users/raviailani/Downloads/django-vue-admin/web/src/views/system/rolePermission/index.vue","mtime":1674694301503},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/css-loader/dist/cjs.js","mtime":1674694549148},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1674694549593},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/postcss-loader/src/index.js","mtime":1674694549280},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/sass-loader/dist/cjs.js","mtime":1674694548949},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js","mtime":1674694549360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci55eHRJbnB1dCB7CiAgLmVsLWZvcm0taXRlbV9fbGFiZWwgewogICAgY29sb3I6ICM0OWExZmY7CiAgfQp9CgouZGVwdC10cmVlOjotd2Via2l0LXNjcm9sbGJhciB7CiAgZGlzcGxheTogbm9uZTsgLyogQ2hyb21lIFNhZmFyaSAqLwp9CgouZGVwdC10cmVlIHsKICBoZWlnaHQ6IDE2MHB4OwogIG92ZXJmbG93LXk6IHNjcm9sbDsKICBzY3JvbGxiYXItd2lkdGg6IG5vbmU7IC8qIGZpcmVmb3ggKi8KICAtbXMtb3ZlcmZsb3ctc3R5bGU6IG5vbmU7IC8qIElFIDEwKyAqLwp9CgouZmxvdy10cmVlIHsKICBvdmVyZmxvdzogYXV0bzsKICBmbGV4OiAxOwoKICBtYXJnaW46IDEwcHg7CgogIC5lbC10cmVlLW5vZGUgewogICAgLmVsLXRyZWUtbm9kZV9fY2hpbGRyZW4gewogICAgICBvdmVyZmxvdzogdmlzaWJsZSAhaW1wb3J0YW50CiAgICB9CiAgfQp9Cgo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAgUA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/system/rolePermission","sourcesContent":["<!--\n * @创建文件时间: 2021-06-01 22:41:21\n * @Auther: 猿小天\n * @最后修改人: 猿小天\n * @最后修改时间: 2021-09-26 21:18:29\n * 联系Qq:1638245306\n * @文件介绍:授权管理\n-->\n<template>\n  <div>\n    <div style=\"margin: 10px\">\n      <el-button\n        type=\"primary\"\n        size=\"mini\"\n        @click=\"submitPermisson\"\n        v-permission=\"'Save'\"\n      >保存\n      </el-button>\n    </div>\n    <el-container style=\"height: 80vh; border: 1px solid #eee\">\n      <el-aside width=\"300px\" style=\"border:1px solid #eee;padding: 20px;\">\n        <div style=\"margin: 10px;\">\n          <div style=\"margin-bottom: 20px\">\n            <div class=\"yxt-flex-align-center\">\n              <div class=\"yxt-divider\"></div>\n              <span>数据授权</span>\n              <el-tooltip\n                class=\"item\"\n                effect=\"dark\"\n                :content=\"dataAuthorizationTips\"\n                placement=\"right\"\n              >\n                <el-icon class=\"el-icon-question\"></el-icon>\n              </el-tooltip>\n            </div>\n          </div>\n\n          <div>\n            <el-select\n              v-show=\"roleObj.name\"\n              v-model=\"roleObj.data_range\"\n              @change=\"dataScopeSelectChange\"\n            >\n              <el-option\n                v-for=\"item in dataScopeOptions\"\n                :key=\"item.value\"\n                :label=\"item.label\"\n                :value=\"item.value\"\n              ></el-option>\n            </el-select>\n          </div>\n\n          <div v-show=\"roleObj.data_range === 4\" class=\"dept-tree\">\n            <el-tree\n              :data=\"deptOptions\"\n              show-checkbox\n              default-expand-all\n              :default-checked-keys=\"deptCheckedKeys\"\n              ref=\"dept\"\n              node-key=\"id\"\n              :check-strictly=\"true\"\n              :props=\"{ label: 'name' }\"\n            ></el-tree>\n          </div>\n\n        </div>\n      </el-aside>\n      <el-main>\n        <div style=\"margin: 10px;\">\n          <div>\n            <div style=\"margin-bottom: 20px\">\n              <div class=\"yxt-flex-align-center\">\n                <div class=\"yxt-divider\"></div>\n                <span>菜单授权</span>\n                <el-tooltip\n                  class=\"item\"\n                  effect=\"dark\"\n                  :content=\"menuAuthorizationTips\"\n                  placement=\"right\"\n                >\n                  <el-icon class=\"el-icon-question\"></el-icon>\n                </el-tooltip>\n              </div>\n            </div>\n            <el-tree\n              class=\"flow-tree\"\n              ref=\"menuTree\"\n              :data=\"menuOptions\"\n              node-key=\"id\"\n              default-expand-all\n              show-checkbox\n              :expand-on-click-node=\"false\"\n              :default-checked-keys=\"menuCheckedKeys\"\n              :check-on-click-node=\"false\"\n              empty-text=\"请先选择角色\"\n              :check-strictly=\"menuCheckStrictly\"\n              @check-change=\"handleCheckClick\"\n            >\n              <span class=\"custom-tree-node\" slot-scope=\"{ node, data }\">\n                <div class=\"yxt-flex-between\">\n                  <div :style=\"{width:((4-node.level)*18+100)+'px'}\">{{ data.name }}</div>\n                  <div>\n                    <el-checkbox\n                      v-for=\"(item, index) in data.menuPermission\"\n                      :key=\"index\"\n                      v-model=\"item.checked\"\n                    >{{ item.name }}</el-checkbox>\n                  </div>\n                </div>\n              </span>\n            </el-tree>\n          </div>\n        </div>\n        <el-backtop target=\".el-main\"></el-backtop>\n      </el-main>\n    </el-container>\n  </div>\n</template>\n\n<script>\nimport * as api from './api'\nimport XEUtils from 'xe-utils'\n\nexport default {\n  name: 'rolePermission',\n  props: {\n    roleObj: {\n      type: Object,\n      default () {\n        return {\n          name: null,\n          data_range: null\n        }\n      }\n    }\n  },\n  data () {\n    return {\n      filterText: '',\n      data: [],\n      menuOptions: [],\n      permissionData: [],\n      menuCheckedKeys: [], // 菜单默认选中的节点\n      menuCheckStrictly: false,\n      deptOptions: [],\n      deptCheckedKeys: [],\n      dataScopeOptions: [\n        {\n          value: 0,\n          label: '仅本人数据权限'\n        },\n        {\n          value: 1,\n          label: '本部门及以下数据权限'\n        },\n        {\n          value: 2,\n          label: '本部门数据权限'\n        },\n        {\n          value: 3,\n          label: '全部数据权限'\n        },\n        {\n          value: 4,\n          label: '自定义数据权限'\n        }\n      ],\n      dataAuthorizationTips: '授权用户可操作的数据范围',\n      menuAuthorizationTips: '授权用户在菜单中可操作的范围'\n    }\n  },\n  watch: {\n    filterText (val) {\n      this.$refs.tree.filter(val)\n    }\n  },\n  methods: {\n    filterNode (value, data) {\n      if (!value) return true\n      return data.label.indexOf(value) !== -1\n    },\n    getCrudOptions () {\n      // eslint-disable-next-line no-undef\n      return crudOptions(this)\n    },\n    pageRequest (query) {\n      return api.GetList(query).then(res => {\n        res.map((value, index) => {\n          value.node_id = index\n        })\n        this.data = res\n        this.$nextTick().then(() => {\n          this.initNode()\n        })\n      })\n    },\n    initNode () {\n      this.getDeptData()\n      this.getMenuData(this.roleObj)\n      this.menuCheckedKeys = this.roleObj.menu // 加载已勾选的菜单\n      this.menuCheckStrictly = true // 父子不相互关联\n      this.deptCheckedKeys = this.roleObj.dept\n      this.GetDataScope()\n    },\n    addRequest (row) {\n      return api.createObj(row)\n    },\n    updateRequest (row) {\n      return api.UpdateObj(row)\n    },\n    delRequest (row) {\n      return api.DelObj(row.id)\n    },\n    // 获取部门数据\n    getDeptData () {\n      api.GetDataScopeDept().then(ret => {\n        this.deptOptions = XEUtils.toArrayTree(ret.data, { parentKey: 'parent', strict: false })\n      })\n    },\n    // 获取菜单数据\n    getMenuData (data) {\n      api.GetMenuData(data).then(res => {\n        res.forEach(x => {\n          // 根据当前角色的permission,对menuPermisson进行勾选处理\n          x.menuPermission.forEach(a => {\n            if (data.permission.indexOf(a.id) > -1) {\n              this.$set(a, 'checked', true)\n            } else {\n              this.$set(a, 'checked', false)\n            }\n          })\n        })\n        // 将菜单列表转换为树形列表\n        this.menuOptions = XEUtils.toArrayTree(res, {\n          parentKey: 'parent',\n          strict: true\n        })\n      })\n    },\n    // 获取权限范围\n    GetDataScope () {\n      api.GetDataScope().then(res => {\n        this.dataScopeOptions = res.data\n      })\n    },\n    // 所有勾选菜单节点数据\n    getMenuAllCheckedKeys () {\n      // 目前被选中的菜单节点\n      const checkedKeys = this.$refs.menuTree.getCheckedKeys()\n      // 半选中的菜单节点\n      const halfCheckedKeys = this.$refs.menuTree.getHalfCheckedKeys()\n      checkedKeys.unshift.apply(checkedKeys, halfCheckedKeys)\n      return checkedKeys\n    },\n    // 所有自定义权限时,勾选的部门节点数据\n    getDeptAllCheckedKeys () {\n      // 目前被选中的部门节点\n      const checkedKeys = this.$refs.dept.getCheckedKeys()\n      // 半选中的部门节点\n      const halfCheckedKeys = this.$refs.dept.getHalfCheckedKeys()\n      checkedKeys.unshift.apply(checkedKeys, halfCheckedKeys)\n      return checkedKeys\n    },\n    // 提交修改\n    submitPermisson () {\n      this.roleObj.menu = this.getMenuAllCheckedKeys() // 获取选中的菜单\n      this.roleObj.dept = this.getDeptAllCheckedKeys() // 获取选中的部门\n      const menuData = XEUtils.toTreeArray(this.menuOptions)\n      const permissionData = []\n      menuData.forEach(x => {\n        const checkedPermission = x.menuPermission.filter(f => {\n          return f.checked\n        })\n\n        if (checkedPermission.length > 0) {\n          for (const item of checkedPermission) {\n            permissionData.push(item.id)\n          }\n        }\n      })\n      this.roleObj.permission = permissionData\n      return this.updateRequest(this.roleObj).then(res => {\n        this.$message.success('更新成功')\n      })\n    },\n    /** 选择角色权限范围触发 */\n    dataScopeSelectChange (value) {\n      if (value !== 4) {\n        // this.$refs.dept.setCheckedKeys([]);\n      }\n    },\n    /**\n     * 菜单树点击,全选权限部分数据\n     * @param data\n     */\n    handleCheckClick (data, checked) {\n      const {\n        menuPermission,\n        children,\n        parent\n      } = data\n      this.menuCheckStrictly = false\n      for (const item of menuPermission) {\n        this.$set(item, 'checked', checked)\n      }\n      if (children && parent) {\n        for (const item of children) {\n          this.$refs.menuTree.setChecked(item.id, checked)\n        }\n      }\n    }\n  },\n  created () {\n    this.pageRequest()\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.yxtInput {\n  .el-form-item__label {\n    color: #49a1ff;\n  }\n}\n\n.dept-tree::-webkit-scrollbar {\n  display: none; /* Chrome Safari */\n}\n\n.dept-tree {\n  height: 160px;\n  overflow-y: scroll;\n  scrollbar-width: none; /* firefox */\n  -ms-overflow-style: none; /* IE 10+ */\n}\n\n.flow-tree {\n  overflow: auto;\n  flex: 1;\n\n  margin: 10px;\n\n  .el-tree-node {\n    .el-tree-node__children {\n      overflow: visible !important\n    }\n  }\n}\n\n</style>\n"]}]}