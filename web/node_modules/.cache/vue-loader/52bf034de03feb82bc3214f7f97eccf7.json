{"remainingRequest":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/raviailani/Downloads/django-vue-admin/web/node_modules/d2p-extends/src/file-uploader/lib/cropper-uploader.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/d2p-extends/src/file-uploader/lib/cropper-uploader.vue","mtime":1674694550311},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/babel-loader/lib/index.js","mtime":1674694549283},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js","mtime":1674694549360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgRDJwQ3JvcHBlciBmcm9tICcuL2Nyb3BwZXInDQppbXBvcnQgRDJwVXBsb2FkZXIgZnJvbSAnLi4vLi4vdXBsb2FkZXInDQppbXBvcnQgeyBkMkNydWRQbHVzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZDItY3J1ZC1wbHVzJw0KaW1wb3J0IGxvZyBmcm9tICcuLi8uLi91dGlscy91dGlsLmxvZycNCi8qKg0KICog5Zu+54mH6KOB5Ymq5LiK5Lyg57uE5Lu2LOWwgeijheS6hmQycC1jcm9wcGVyLCBkMnAtY3JvcHBlcuWGhemDqOWwgeijheS6hmNyb3BwZXJqcw0KICovDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ2QycC1jcm9wcGVyLXVwbG9hZGVyJywNCiAgbWl4aW5zOiBbZDJDcnVkUGx1cy5pbnB1dEJhc2VdLA0KICBjb21wb25lbnRzOiB7DQogICAgRDJwQ3JvcHBlcg0KICB9LA0KICBwcm9wczogew0KICAgIC8vIOWIneWni+WbvueJh3VybA0KICAgIHZhbHVlOiB7DQogICAgICB0eXBlOiBbU3RyaW5nLCBBcnJheV0NCiAgICB9LA0KICAgIC8vIOS4iuS8oOWQjuerr+exu+Wei++8jFtmb3JtLCBjb3MsIHFpbml1ICwgYWxpb3NzXQ0KICAgIHR5cGU6IHsNCiAgICAgIHR5cGU6IFN0cmluZw0KICAgIH0sDQogICAgLy8g5LiK5Lyg5o+Q56S6DQogICAgdXBsb2FkVGlwOiB7DQogICAgICB0eXBlOiBTdHJpbmcNCiAgICB9LA0KICAgIC8vIOWvueivneahhuagh+mimA0KICAgIHRpdGxlOiBTdHJpbmcsDQogICAgLy8gY3JvcHBlcueahOmrmOW6pu+8jOm7mOiupOS4uua1j+iniOWZqOWPr+inhueql+WPo+mrmOW6pueahDQwJe+8jOacgOWwjzI3MA0KICAgIGNyb3BwZXJIZWlnaHQ6IHsNCiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0NCiAgICB9LA0KICAgIC8vIOWvueivneahhuWuveW6pu+8jOm7mOiupDUwJQ0KICAgIGRpYWxvZ1dpZHRoOiB7DQogICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLA0KICAgICAgZGVmYXVsdDogJzUwJScNCiAgICB9LA0KICAgIC8vIOWbvueJh+Wkp+Wwj+mZkOWItu+8jOWNleS9jU1CDQogICAgbWF4U2l6ZTogew0KICAgICAgdHlwZTogTnVtYmVyLA0KICAgICAgZGVmYXVsdDogNQ0KICAgIH0sDQogICAgLy8g5Zu+54mH5pWw6YeP6ZmQ5Yi2LDDkuLrkuI3pmZDliLYNCiAgICBsaW1pdDogew0KICAgICAgdHlwZTogTnVtYmVyLA0KICAgICAgZGVmYXVsdDogMQ0KICAgIH0sDQogICAgLy8g5Y+v5o6l5pS255qE5paH5Lu25ZCO57yADQogICAgYWNjZXB0OiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiAnLmpwZywgLmpwZWcsIC5wbmcsIC5naWYsIC53ZWJwJw0KICAgIH0sDQogICAgLy8gW2Nyb3BwZXJqc+eahOWPguaVsF0oaHR0cHM6Ly9naXRodWIuY29tL2Zlbmd5dWFuY2hlbi9jcm9wcGVyanMpDQogICAgY3JvcHBlcjogew0KICAgICAgdHlwZTogT2JqZWN0DQogICAgfSwNCiAgICAvLyDkuIrkvKDlj4LmlbDvvIzkvJrkuLTml7bopobnm5blhajlsYDkuIrkvKDphY3nva7lj4LmlbBbZDJwLXVwbG9hZGVyXSgvZ3VpZGUvZXh0ZW5kcy91cGxvYWRlci5odG1sKQ0KICAgIHVwbG9hZGVyOiB7DQogICAgICB0eXBlOiBPYmplY3QNCiAgICB9LA0KICAgIC8vIOaehOW7uuS4i+i9vXVybOaWueazlSzkuI3lvbHlk43mj5DkuqTnmoR2YWx1ZQ0KICAgIGJ1aWxkVXJsOiB7DQogICAgICB0eXBlOiBGdW5jdGlvbiwNCiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uICh2YWx1ZSwgaXRlbSkgeyByZXR1cm4gKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpID8gaXRlbS51cmwgOiB2YWx1ZSB9DQogICAgfQ0KDQogIH0sDQogIGRhdGEgKCkgew0KICAgIHJldHVybiB7DQogICAgICBpbmRleDogdW5kZWZpbmVkLA0KICAgICAgbGlzdDogW10NCiAgICB9DQogIH0sDQogIHdhdGNoOiB7DQogICAgdmFsdWUgKHZhbCkgew0KICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlJywgdmFsKQ0KICAgICAgaWYgKHZhbCA9PT0gdGhpcy5lbWl0VmFsdWUpIHsNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICB0aGlzLmluaXRWYWx1ZSh2YWwpDQogICAgfQ0KICB9LA0KICBjcmVhdGVkICgpIHsNCiAgICB0aGlzLmVtaXRWYWx1ZSA9IHRoaXMudmFsdWUNCiAgICB0aGlzLmluaXRWYWx1ZSh0aGlzLnZhbHVlKQ0KICB9LA0KICBjb21wdXRlZDogew0KICAgIF91cmxMaXN0ICgpIHsNCiAgICAgIGNvbnN0IHVybExpc3QgPSBbXQ0KICAgICAgaWYgKHRoaXMubGlzdCkgew0KICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdGhpcy5saXN0KSB7DQogICAgICAgICAgdXJsTGlzdC5wdXNoKGl0ZW0udXJsKQ0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gdXJsTGlzdA0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGluaXRWYWx1ZSAodmFsdWUpIHsNCiAgICAgIGNvbnN0IGxpc3QgPSBbXQ0KICAgICAgaWYgKHZhbHVlID09IG51bGwgfHwgdmFsdWUgPT09ICcnKSB7DQogICAgICAgIHRoaXMuJHNldCh0aGlzLCAnbGlzdCcsIGxpc3QpDQogICAgICAgIHJldHVybg0KICAgICAgfQ0KICAgICAgaWYgKHR5cGVvZiAodmFsdWUpID09PSAnc3RyaW5nJykgew0KICAgICAgICBsaXN0LnB1c2goeyB1cmw6IHRoaXMuYnVpbGRVcmwodmFsdWUpLCB2YWx1ZTogdmFsdWUsIHN0YXR1czogJ2RvbmUnIH0pDQogICAgICB9IGVsc2Ugew0KICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdmFsdWUpIHsNCiAgICAgICAgICBsaXN0LnB1c2goeyB1cmw6IHRoaXMuYnVpbGRVcmwoaXRlbSksIHZhbHVlOiBpdGVtLCBzdGF0dXM6ICdkb25lJyB9KQ0KICAgICAgICB9DQogICAgICB9DQogICAgICB0aGlzLiRzZXQodGhpcywgJ2xpc3QnLCBsaXN0KQ0KICAgIH0sDQogICAgYWRkTmV3SW1hZ2UgKCkgew0KICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICB0aGlzLmluZGV4ID0gdW5kZWZpbmVkDQogICAgICB0aGlzLiRyZWZzLmNyb3BwZXIuY2xlYXIoKQ0KICAgICAgdGhpcy4kcmVmcy5jcm9wcGVyLm9wZW4oKQ0KICAgIH0sDQogICAgcmVtb3ZlSW1hZ2UgKGluZGV4LCBpdGVtKSB7DQogICAgICB0aGlzLmxpc3Quc3BsaWNlKGluZGV4LCAxKQ0KICAgICAgdGhpcy5lbWl0KCkNCiAgICB9LA0KICAgIGlzSGFzVXBsb2FkaW5nSXRlbSAoKSB7DQogICAgICBjb25zdCBmaWxlTGlzdCA9IHRoaXMubGlzdA0KICAgICAgaWYgKGZpbGVMaXN0ICYmIGZpbGVMaXN0Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGZpbGVMaXN0KSB7DQogICAgICAgICAgaWYgKGl0ZW0uc3RhdHVzID09PSAndXBsb2FkaW5nJykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZQ0KICAgIH0sDQogICAgYXN5bmMgY3JvcENvbXBsZXRlIChyZXQpIHsNCiAgICAgIGNvbnN0IGJsb2IgPSByZXQuYmxvYg0KICAgICAgY29uc3QgZGF0YVVybCA9IHJldC5kYXRhVXJsDQogICAgICBjb25zdCBmaWxlID0gcmV0LmZpbGUNCiAgICAgIC8vIOW8gOWni+S4iuS8oA0KICAgICAgY29uc3QgaXRlbSA9IHsNCiAgICAgICAgdXJsOiB1bmRlZmluZWQsDQogICAgICAgIGRhdGFVcmw6IGRhdGFVcmwsDQogICAgICAgIHN0YXR1czogJ3VwbG9hZGluZycsDQogICAgICAgIHByb2dyZXNzOiAwDQogICAgICB9DQogICAgICBjb25zdCBvblByb2dyZXNzID0gKGUpID0+IHsNCiAgICAgICAgaXRlbS5wcm9ncmVzcyA9IGUucGVyY2VudA0KICAgICAgfQ0KICAgICAgY29uc3Qgb25FcnJvciA9IChlKSA9PiB7DQogICAgICAgIGl0ZW0uc3RhdHVzID0gJ2Vycm9yJw0KICAgICAgICBpdGVtLm1lc3NhZ2UgPSAn5paH5Lu25LiK5Lyg5Ye66ZSZOicgKyBlLm1lc3NhZ2UNCiAgICAgICAgbG9nLmRlYnVnKGUpDQogICAgICB9DQogICAgICBsb2cuZGVidWcoJ2Jsb2I6JywgYmxvYikNCiAgICAgIGNvbnN0IG9wdGlvbiA9IHsNCiAgICAgICAgZmlsZTogYmxvYiwNCiAgICAgICAgZmlsZU5hbWU6IGZpbGUubmFtZSwNCiAgICAgICAgb25Qcm9ncmVzcywNCiAgICAgICAgb25FcnJvcg0KICAgICAgfQ0KICAgICAgdGhpcy5saXN0LnB1c2goaXRlbSkNCiAgICAgIGNvbnN0IHVwbG9hZCA9IGF3YWl0IHRoaXMuZG9VcGxvYWQob3B0aW9uKQ0KICAgICAgaXRlbS51cmwgPSB0aGlzLmJ1aWxkVXJsKHVwbG9hZC51cmwpDQogICAgICBpdGVtLnZhbHVlID0gdXBsb2FkLnVybA0KICAgICAgaXRlbS5zdGF0dXMgPSAnZG9uZScNCiAgICAgIHRoaXMuZW1pdCgpDQogICAgfSwNCiAgICBkb1VwbG9hZCAob3B0aW9uKSB7DQogICAgICBvcHRpb24uY29uZmlnID0gdGhpcy51cGxvYWRlcg0KICAgICAgcmV0dXJuIHRoaXMuZ2V0VXBsb2FkZXIoKS50aGVuKHVwbG9hZGVyID0+IHsNCiAgICAgICAgcmV0dXJuIHVwbG9hZGVyLnVwbG9hZChvcHRpb24pLnRoZW4ocmV0ID0+IHsNCiAgICAgICAgICBpZiAodGhpcy5zdWZmaXggIT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0LnVybCArPSB0aGlzLnN1ZmZpeA0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gcmV0DQogICAgICAgIH0pDQogICAgICB9KQ0KICAgIH0sDQogICAgZ2V0VXBsb2FkZXIgKCkgew0KICAgICAgbGV0IHR5cGUgPSB0aGlzLnR5cGUNCiAgICAgIGlmICh0aGlzLnVwbG9hZGVyICE9IG51bGwgJiYgdGhpcy51cGxvYWRlci50eXBlICE9IG51bGwpIHsNCiAgICAgICAgdHlwZSA9IHRoaXMudXBsb2FkZXIudHlwZQ0KICAgICAgfQ0KICAgICAgcmV0dXJuIEQycFVwbG9hZGVyLmdldFVwbG9hZGVyKHR5cGUpDQogICAgfSwNCiAgICBlbWl0ICgpIHsNCiAgICAgIGNvbnN0IGxpc3QgPSBbXQ0KICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMubGlzdCkgew0KICAgICAgICBpZiAoaXRlbS5zdGF0dXMgIT0gbnVsbCAmJiBpdGVtLnN0YXR1cyAhPT0gJ2RvbmUnKSB7DQogICAgICAgICAgLy8g5YWo6YOo5LiK5Lyg5a6M5YaN5Y+R6YCa55+lDQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgaWYgKHR5cGVvZiAoaXRlbSkgPT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgbGlzdC5wdXNoKGl0ZW0pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbGlzdC5wdXNoKGl0ZW0udmFsdWUpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGxldCByZXQgPSBsaXN0DQogICAgICBpZiAodGhpcy5saW1pdCA9PT0gMSkgew0KICAgICAgICByZXQgPSAoKGxpc3QgJiYgbGlzdC5sZW5ndGggPiAwKSA/IGxpc3RbMF0gOiB1bmRlZmluZWQpDQogICAgICB9DQogICAgICB0aGlzLmVtaXRWYWx1ZSA9IHJldA0KICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCByZXQpDQogICAgfQ0KDQogIH0NCn0NCg=="},{"version":3,"sources":["cropper-uploader.vue"],"names":[],"mappings":";AAyCA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"cropper-uploader.vue","sourceRoot":"node_modules/d2p-extends/src/file-uploader/lib","sourcesContent":["<template>\r\n  <div class=\"d2p-cropper-uploader\"  :class=\"{'is-disabled':disabled}\" >\r\n    <div class=\"image-list\">\r\n      <div class=\"image-item\" v-for=\"(item,index) in list\" :key=\"index\">\r\n        <el-image class=\"image\"\r\n          :src=\"item.dataUrl?item.dataUrl:item.url\"\r\n          :data-src=\"item.url\"\r\n          :preview-src-list=\"_urlList\"\r\n          fit=\"contain\" >\r\n          <div slot=\"placeholder\" class=\"image-slot\">\r\n            <img src=\"./loading-spin.svg\">\r\n          </div>\r\n        </el-image>\r\n        <div class=\"delete\" v-if=\"!disabled\"><i class=\"el-icon-delete\" @click=\"removeImage(index,item)\"></i></div>\r\n        <div class=\"status-uploading\" v-if=\"item.status==='uploading'\">\r\n          <el-progress type=\"circle\" :percentage=\"item.progress\" :width=\"70\"/>\r\n        </div>\r\n        <div class=\"status-done\" v-else-if=\"item.status==='done'\">\r\n          <i class=\"el-icon-upload-success el-icon-check\"></i>\r\n        </div>\r\n      </div>\r\n      <div v-if=\"limit <=0 || limit>list.length\" class=\"image-item image-plus\" @click=\"addNewImage\">\r\n        <i class=\"el-icon-plus cropper-uploader-icon\"></i>\r\n      </div>\r\n    </div>\r\n    <d2p-cropper ref=\"cropper\"\r\n                        :title=\"title\"\r\n                        :cropperHeight=\"cropperHeight\"\r\n                        :dialogWidth=\"dialogWidth\"\r\n                        :accept=\"accept\"\r\n                        :uploadTip=\"uploadTip\"\r\n                        :maxSize=\"maxSize\"\r\n                        :cropper=\"cropper\"\r\n                        output=\"all\"\r\n                        @done=\"cropComplete\"\r\n    ></d2p-cropper>\r\n  </div>\r\n\r\n</template>\r\n\r\n<script>\r\nimport D2pCropper from './cropper'\r\nimport D2pUploader from '../../uploader'\r\nimport { d2CrudPlus } from '../../utils/d2-crud-plus'\r\nimport log from '../../utils/util.log'\r\n/**\r\n * 图片裁剪上传组件,封装了d2p-cropper, d2p-cropper内部封装了cropperjs\r\n */\r\n\r\nexport default {\r\n  name: 'd2p-cropper-uploader',\r\n  mixins: [d2CrudPlus.inputBase],\r\n  components: {\r\n    D2pCropper\r\n  },\r\n  props: {\r\n    // 初始图片url\r\n    value: {\r\n      type: [String, Array]\r\n    },\r\n    // 上传后端类型，[form, cos, qiniu , alioss]\r\n    type: {\r\n      type: String\r\n    },\r\n    // 上传提示\r\n    uploadTip: {\r\n      type: String\r\n    },\r\n    // 对话框标题\r\n    title: String,\r\n    // cropper的高度，默认为浏览器可视窗口高度的40%，最小270\r\n    cropperHeight: {\r\n      type: [String, Number]\r\n    },\r\n    // 对话框宽度，默认50%\r\n    dialogWidth: {\r\n      type: [String, Number],\r\n      default: '50%'\r\n    },\r\n    // 图片大小限制，单位MB\r\n    maxSize: {\r\n      type: Number,\r\n      default: 5\r\n    },\r\n    // 图片数量限制,0为不限制\r\n    limit: {\r\n      type: Number,\r\n      default: 1\r\n    },\r\n    // 可接收的文件后缀\r\n    accept: {\r\n      type: String,\r\n      default: '.jpg, .jpeg, .png, .gif, .webp'\r\n    },\r\n    // [cropperjs的参数](https://github.com/fengyuanchen/cropperjs)\r\n    cropper: {\r\n      type: Object\r\n    },\r\n    // 上传参数，会临时覆盖全局上传配置参数[d2p-uploader](/guide/extends/uploader.html)\r\n    uploader: {\r\n      type: Object\r\n    },\r\n    // 构建下载url方法,不影响提交的value\r\n    buildUrl: {\r\n      type: Function,\r\n      default: function (value, item) { return (typeof value === 'object') ? item.url : value }\r\n    }\r\n\r\n  },\r\n  data () {\r\n    return {\r\n      index: undefined,\r\n      list: []\r\n    }\r\n  },\r\n  watch: {\r\n    value (val) {\r\n      this.$emit('change', val)\r\n      if (val === this.emitValue) {\r\n        return\r\n      }\r\n      this.initValue(val)\r\n    }\r\n  },\r\n  created () {\r\n    this.emitValue = this.value\r\n    this.initValue(this.value)\r\n  },\r\n  computed: {\r\n    _urlList () {\r\n      const urlList = []\r\n      if (this.list) {\r\n        for (const item of this.list) {\r\n          urlList.push(item.url)\r\n        }\r\n      }\r\n      return urlList\r\n    }\r\n  },\r\n  methods: {\r\n    initValue (value) {\r\n      const list = []\r\n      if (value == null || value === '') {\r\n        this.$set(this, 'list', list)\r\n        return\r\n      }\r\n      if (typeof (value) === 'string') {\r\n        list.push({ url: this.buildUrl(value), value: value, status: 'done' })\r\n      } else {\r\n        for (const item of value) {\r\n          list.push({ url: this.buildUrl(item), value: item, status: 'done' })\r\n        }\r\n      }\r\n      this.$set(this, 'list', list)\r\n    },\r\n    addNewImage () {\r\n      if (this.disabled) {\r\n        return\r\n      }\r\n      this.index = undefined\r\n      this.$refs.cropper.clear()\r\n      this.$refs.cropper.open()\r\n    },\r\n    removeImage (index, item) {\r\n      this.list.splice(index, 1)\r\n      this.emit()\r\n    },\r\n    isHasUploadingItem () {\r\n      const fileList = this.list\r\n      if (fileList && fileList.length > 0) {\r\n        for (const item of fileList) {\r\n          if (item.status === 'uploading') {\r\n            return true\r\n          }\r\n        }\r\n      }\r\n      return false\r\n    },\r\n    async cropComplete (ret) {\r\n      const blob = ret.blob\r\n      const dataUrl = ret.dataUrl\r\n      const file = ret.file\r\n      // 开始上传\r\n      const item = {\r\n        url: undefined,\r\n        dataUrl: dataUrl,\r\n        status: 'uploading',\r\n        progress: 0\r\n      }\r\n      const onProgress = (e) => {\r\n        item.progress = e.percent\r\n      }\r\n      const onError = (e) => {\r\n        item.status = 'error'\r\n        item.message = '文件上传出错:' + e.message\r\n        log.debug(e)\r\n      }\r\n      log.debug('blob:', blob)\r\n      const option = {\r\n        file: blob,\r\n        fileName: file.name,\r\n        onProgress,\r\n        onError\r\n      }\r\n      this.list.push(item)\r\n      const upload = await this.doUpload(option)\r\n      item.url = this.buildUrl(upload.url)\r\n      item.value = upload.url\r\n      item.status = 'done'\r\n      this.emit()\r\n    },\r\n    doUpload (option) {\r\n      option.config = this.uploader\r\n      return this.getUploader().then(uploader => {\r\n        return uploader.upload(option).then(ret => {\r\n          if (this.suffix != null) {\r\n            ret.url += this.suffix\r\n          }\r\n          return ret\r\n        })\r\n      })\r\n    },\r\n    getUploader () {\r\n      let type = this.type\r\n      if (this.uploader != null && this.uploader.type != null) {\r\n        type = this.uploader.type\r\n      }\r\n      return D2pUploader.getUploader(type)\r\n    },\r\n    emit () {\r\n      const list = []\r\n      for (const item of this.list) {\r\n        if (item.status != null && item.status !== 'done') {\r\n          // 全部上传完再发通知\r\n          return\r\n        }\r\n        if (typeof (item) === 'string') {\r\n          list.push(item)\r\n        } else {\r\n          list.push(item.value)\r\n        }\r\n      }\r\n      let ret = list\r\n      if (this.limit === 1) {\r\n        ret = ((list && list.length > 0) ? list[0] : undefined)\r\n      }\r\n      this.emitValue = ret\r\n      this.$emit('input', ret)\r\n    }\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" >\r\n  .d2p-cropper-uploader{\r\n    .el-image-viewer__close{color:#fff}\r\n    &.is-disabled {\r\n      .image-list{\r\n        .image-item{\r\n          cursor: not-allowed;\r\n        }\r\n      }\r\n      i{cursor: not-allowed}\r\n    }\r\n    .image-list{\r\n      display: flex;\r\n      justify-content: left;\r\n      align-items: center;\r\n      flex-wrap: wrap;\r\n      .image-item{\r\n        width: 100px;\r\n        height: 100px;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        background-color: #fbfdff;\r\n        border: 1px solid #c0ccda;\r\n        border-radius: 6px;\r\n        position: relative;\r\n        margin-right: 8px;\r\n        margin-bottom: 8px;\r\n        cursor: pointer;\r\n        overflow: hidden;\r\n        &.image-plus{\r\n          border: 1px dashed #c0ccda;\r\n        }\r\n        .cropper-uploader-icon {\r\n          vertical-align: top;\r\n          font-size: 28px;\r\n          color: #8c939d;\r\n        }\r\n        .image{\r\n          width: 100px;\r\n          height: 100px;\r\n        }\r\n\r\n        .delete{\r\n          border-radius: 6px;\r\n          position: absolute;\r\n          width: 100%;\r\n          height: 100%;\r\n          left: 0;\r\n          top: 0;\r\n          cursor: default;\r\n          text-align: center;\r\n          color: #fff;\r\n          opacity: 0;\r\n          font-size: 20px;\r\n          background-color: rgba(0,0,0,.9);\r\n          -webkit-transition: opacity .3s;\r\n          transition: opacity .3s;\r\n          &:hover{\r\n            opacity: 0.9;\r\n          }\r\n          display: flex;\r\n          justify-content: center;\r\n          align-items: center;\r\n          i{\r\n            cursor: pointer;\r\n          }\r\n        }\r\n        .status-uploading{\r\n          border-radius: 6px;\r\n          position: absolute;\r\n          width: 100%;\r\n          height: 100%;\r\n          left: 0;\r\n          top: 0;\r\n          cursor: default;\r\n          text-align: center;\r\n          color: #fff;\r\n          opacity: 1;\r\n          font-size: 20px;\r\n          background-color: rgba(0, 0, 0, 0.5);\r\n          -webkit-transition: opacity .3s;\r\n          transition: opacity .3s;\r\n          display: flex;\r\n          justify-content: center;\r\n          align-items: center;\r\n          .el-progress{\r\n            width: 70px;\r\n            height: 70px;\r\n            .el-progress__text {\r\n              color:#fff;\r\n            }\r\n          }\r\n\r\n        }\r\n        .status-done{\r\n          position: absolute;\r\n          right: -15px;\r\n          top: -6px;\r\n          width: 40px;\r\n          height: 24px;\r\n          background: #13ce66;\r\n          text-align: center;\r\n          -webkit-transform: rotate(45deg);\r\n          transform: rotate(45deg);\r\n          -webkit-box-shadow: 0 0 1pc 1px rgba(0,0,0,.2);\r\n          box-shadow: 0 0 1pc 1px rgba(0,0,0,.2);\r\n          display: flex;\r\n          justify-content: center;\r\n          align-items: center;\r\n          i{\r\n            font-size: 12px;\r\n            margin-top: 11px;\r\n            color: #fff;\r\n            -webkit-transform: rotate(-45deg);\r\n            transform: rotate(-45deg);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n</style>\r\n"]}]}