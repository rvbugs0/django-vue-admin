{"remainingRequest":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/raviailani/Downloads/django-vue-admin/web/src/layout/header-aside/components/panel-search/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/raviailani/Downloads/django-vue-admin/web/src/layout/header-aside/components/panel-search/index.vue","mtime":1674694301485},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/babel-loader/lib/index.js","mtime":1674694549283},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/cache-loader/dist/cjs.js","mtime":1674694548948},{"path":"/Users/raviailani/Downloads/django-vue-admin/web/node_modules/vue-loader/lib/index.js","mtime":1674694549360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBGdXNlIGZyb20gJ2Z1c2UuanMnCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCcKaW1wb3J0IG1peGluIGZyb20gJy4uL21peGluL21lbnUnCmV4cG9ydCBkZWZhdWx0IHsKICBtaXhpbnM6IFsKICAgIG1peGluCiAgXSwKICBjb21wb25lbnRzOiB7CiAgICAnZDItcGFuZWwtc2VhcmNoLWl0ZW0nOiAoKSA9PiBpbXBvcnQoJy4vY29tcG9uZW50cy9wYW5lbC1zZWFyY2gtaXRlbS9pbmRleC52dWUnKQogIH0sCiAgZGF0YSAoKSB7CiAgICByZXR1cm4gewogICAgICBzZWFyY2hUZXh0OiAnJywKICAgICAgcmVzdWx0czogW10KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZSgnZDJhZG1pbi9zZWFyY2gnLCBbCiAgICAgICdob3RrZXknLAogICAgICAncG9vbCcKICAgIF0pLAogICAgLy8g6L+Z5Lu95pWw5o2u5piv5bGV56S65Zyo5pCc57Si6Z2i5p2/5LiL6Z2i55qECiAgICByZXN1bHRzTGlzdCAoKSB7CiAgICAgIHJldHVybiAodGhpcy5yZXN1bHRzLmxlbmd0aCA9PT0gMCAmJiB0aGlzLnNlYXJjaFRleHQgPT09ICcnKSA/IHRoaXMucG9vbC5tYXAoZSA9PiAoewogICAgICAgIHZhbHVlOiBlLmZ1bGxUaXRsZSwKICAgICAgICAuLi5lCiAgICAgIH0pKSA6IHRoaXMucmVzdWx0cwogICAgfSwKICAgIC8vIOagueaNriBwb29sIOabtOaWsCBmdXNlIOWunuS+iwogICAgZnVzZSAoKSB7CiAgICAgIHJldHVybiBuZXcgRnVzZSh0aGlzLnBvb2wsIHsKICAgICAgICBzaG91bGRTb3J0OiB0cnVlLAogICAgICAgIHRva2VuaXplOiB0cnVlLAogICAgICAgIHRocmVzaG9sZDogMC42LAogICAgICAgIGxvY2F0aW9uOiAwLAogICAgICAgIGRpc3RhbmNlOiAxMDAsCiAgICAgICAgbWF4UGF0dGVybkxlbmd0aDogMzIsCiAgICAgICAgbWluTWF0Y2hDaGFyTGVuZ3RoOiAxLAogICAgICAgIGtleXM6IFsKICAgICAgICAgICdmdWxsVGl0bGUnLAogICAgICAgICAgJ3BhdGgnCiAgICAgICAgXQogICAgICB9KQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLyoqCiAgICAgKiBAZGVzY3JpcHRpb24g6L+H5ruk6YCJ6aG5IOi/meS4quaWueazleWcqOavj+asoei+k+WFpeahhueahOWAvOWPkeeUn+WPmOWMluaXtuS8muinpuWPkQogICAgICovCiAgICBxdWVyeVNlYXJjaCAocXVlcnlTdHJpbmcsIGNhbGxiYWNrKSB7CiAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLmZ1c2Uuc2VhcmNoKHF1ZXJ5U3RyaW5nKS5tYXAoZSA9PiBlLml0ZW0pCiAgICAgIHRoaXMucmVzdWx0cyA9IHJlc3VsdHMKICAgICAgY2FsbGJhY2socmVzdWx0cykKICAgIH0sCiAgICAvKioKICAgICAqIEBkZXNjcmlwdGlvbiDogZrnhKbovpPlhaXmoYYKICAgICAqLwogICAgZm9jdXMgKCkgewogICAgICB0aGlzLmlucHV0ID0gJycKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKHRoaXMuJHJlZnMuaW5wdXQpIHsKICAgICAgICAgIHRoaXMuJHJlZnMuaW5wdXQuZm9jdXMoKQogICAgICAgIH0KICAgICAgICAvLyDov5jljp8KICAgICAgICB0aGlzLnNlYXJjaFRleHQgPSAnJwogICAgICAgIHRoaXMucmVzdWx0cyA9IFtdCiAgICAgIH0sIDUwMCkKICAgIH0sCiAgICAvKioKICAgICAqIEBkZXNjcmlwdGlvbiDmjqXmlLbnlKjmiLflnKjliJfooajkuK3pgInmi6npobnnm67nmoTkuovku7YKICAgICAqLwogICAgaGFuZGxlUmVzdWx0c0dyb3VwSXRlbUNsaWNrIChwYXRoKSB7CiAgICAgIC8vIOWmguaenOeUqOaIt+mAieaLqeeahOWwseaYr+W9k+WJjemhtemdoiDlsLHnm7TmjqXlhbPpl63mkJzntKLpnaLmnb8KICAgICAgaWYgKHBhdGggPT09IHRoaXMuJHJvdXRlLnBhdGgpIHsKICAgICAgICB0aGlzLmhhbmRsZUVzYygpCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgLy8g55So5oi36YCJ5oup55qE5piv5YW25a6D6aG16Z2iCiAgICAgIHRoaXMuaGFuZGxlTWVudVNlbGVjdChwYXRoKQogICAgfSwKICAgIC8qKgogICAgICogQGRlc2NyaXB0aW9uIOaOpeaUtueUqOaIt+WcqOS4i+aLieiPnOWNleS4remAieS4reS6i+S7tgogICAgICovCiAgICBhc3luYyBoYW5kbGVTZWxlY3QgKHsgcGF0aCB9KSB7CiAgICAgIC8vIOWmguaenOeUqOaIt+mAieaLqeeahOWwseaYr+W9k+WJjemhtemdoiDlsLHnm7TmjqXlhbPpl63mkJzntKLpnaLmnb8KICAgICAgaWYgKHBhdGggPT09IHRoaXMuJHJvdXRlLnBhdGgpIHsKICAgICAgICB0aGlzLmhhbmRsZUVzYygpCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgLy8g55So5oi36YCJ5oup55qE5piv5YW25a6D6aG16Z2iCiAgICAgIGF3YWl0IHRoaXMuJG5leHRUaWNrKCkKICAgICAgdGhpcy5oYW5kbGVNZW51U2VsZWN0KHBhdGgpCiAgICB9LAogICAgLyoqCiAgICAgKiBAYXVnbWVudHMg5YWz6Zet6L6T5YWl5qGG55qE5LiL5ouJ6I+c5Y2VCiAgICAgKi8KICAgIGNsb3NlU3VnZ2VzdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLiRyZWZzLmlucHV0LmFjdGl2YXRlZCkgewogICAgICAgIHRoaXMuJHJlZnMuaW5wdXQuc3VnZ2VzdGlvbnMgPSBbXQogICAgICAgIHRoaXMuJHJlZnMuaW5wdXQuYWN0aXZhdGVkID0gZmFsc2UKICAgICAgfQogICAgfSwKICAgIC8qKgogICAgICogQGF1Z21lbnRzIOaOpeaUtueUqOaIt+eCueWHu+epuueZveWMuuWfn+eahOWFs+mXrQogICAgICovCiAgICBoYW5kbGVQYW5lbENsaWNrICgpIHsKICAgICAgdGhpcy5oYW5kbGVFc2MoKQogICAgfSwKICAgIC8qKgogICAgICogQGF1Z21lbnRzIOaOpeaUtueUqOaIt+inpuWPkeeahOWFs+mXrQogICAgICovCiAgICBhc3luYyBoYW5kbGVFc2MgKCkgewogICAgICB0aGlzLmNsb3NlU3VnZ2VzdGlvbigpCiAgICAgIGF3YWl0IHRoaXMuJG5leHRUaWNrKCkKICAgICAgdGhpcy4kZW1pdCgnY2xvc2UnKQogICAgfQogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAyCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/layout/header-aside/components/panel-search","sourcesContent":["<template>\n  <div class=\"panel-search\" flex=\"dir:top\">\n    <div class=\"panel-search__input-group\" flex-box=\"0\" flex=\"dir:top main:center cross:center\" @click.self=\"handlePanelClick\">\n      <d2-icon-svg class=\"panel-search__logo\" name=\"dvadmin\" style=\"width: 200px;height: 200px;\"/>\n      <el-autocomplete\n        class=\"panel-search__input\"\n        ref=\"input\"\n        v-model=\"searchText\"\n        suffix-icon=\"el-icon-search\"\n        placeholder=\"搜索页面\"\n        :fetch-suggestions=\"querySearch\"\n        :trigger-on-focus=\"false\"\n        :clearable=\"true\"\n        @keydown.esc.native=\"handleEsc\"\n        @select=\"handleSelect\">\n        <d2-panel-search-item slot-scope=\"{ item }\" :item=\"item\"/>\n      </el-autocomplete>\n      <div class=\"panel-search__tip\">\n        您可以使用快捷键\n        <span class=\"panel-search__key\">{{hotkey.open}}</span>\n        唤醒搜索面板，按\n        <span class=\"panel-search__key\">{{hotkey.close}}</span>\n        关闭\n      </div>\n    </div>\n    <div v-if=\"resultsList.length > 0\" class=\"panel-search__results-group\" flex-box=\"1\">\n      <el-card shadow=\"never\">\n        <div class=\"panel-search__results-group-inner\">\n          <d2-panel-search-item\n            v-for=\"(item, index) in resultsList\"\n            :key=\"index\"\n            :item=\"item\"\n            :hover-mode=\"true\"\n            @click.native=\"handleResultsGroupItemClick(item.path)\"/>\n        </div>\n      </el-card>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Fuse from 'fuse.js'\nimport { mapState } from 'vuex'\nimport mixin from '../mixin/menu'\nexport default {\n  mixins: [\n    mixin\n  ],\n  components: {\n    'd2-panel-search-item': () => import('./components/panel-search-item/index.vue')\n  },\n  data () {\n    return {\n      searchText: '',\n      results: []\n    }\n  },\n  computed: {\n    ...mapState('d2admin/search', [\n      'hotkey',\n      'pool'\n    ]),\n    // 这份数据是展示在搜索面板下面的\n    resultsList () {\n      return (this.results.length === 0 && this.searchText === '') ? this.pool.map(e => ({\n        value: e.fullTitle,\n        ...e\n      })) : this.results\n    },\n    // 根据 pool 更新 fuse 实例\n    fuse () {\n      return new Fuse(this.pool, {\n        shouldSort: true,\n        tokenize: true,\n        threshold: 0.6,\n        location: 0,\n        distance: 100,\n        maxPatternLength: 32,\n        minMatchCharLength: 1,\n        keys: [\n          'fullTitle',\n          'path'\n        ]\n      })\n    }\n  },\n  methods: {\n    /**\n     * @description 过滤选项 这个方法在每次输入框的值发生变化时会触发\n     */\n    querySearch (queryString, callback) {\n      const results = this.fuse.search(queryString).map(e => e.item)\n      this.results = results\n      callback(results)\n    },\n    /**\n     * @description 聚焦输入框\n     */\n    focus () {\n      this.input = ''\n      setTimeout(() => {\n        if (this.$refs.input) {\n          this.$refs.input.focus()\n        }\n        // 还原\n        this.searchText = ''\n        this.results = []\n      }, 500)\n    },\n    /**\n     * @description 接收用户在列表中选择项目的事件\n     */\n    handleResultsGroupItemClick (path) {\n      // 如果用户选择的就是当前页面 就直接关闭搜索面板\n      if (path === this.$route.path) {\n        this.handleEsc()\n        return\n      }\n      // 用户选择的是其它页面\n      this.handleMenuSelect(path)\n    },\n    /**\n     * @description 接收用户在下拉菜单中选中事件\n     */\n    async handleSelect ({ path }) {\n      // 如果用户选择的就是当前页面 就直接关闭搜索面板\n      if (path === this.$route.path) {\n        this.handleEsc()\n        return\n      }\n      // 用户选择的是其它页面\n      await this.$nextTick()\n      this.handleMenuSelect(path)\n    },\n    /**\n     * @augments 关闭输入框的下拉菜单\n     */\n    closeSuggestion () {\n      if (this.$refs.input.activated) {\n        this.$refs.input.suggestions = []\n        this.$refs.input.activated = false\n      }\n    },\n    /**\n     * @augments 接收用户点击空白区域的关闭\n     */\n    handlePanelClick () {\n      this.handleEsc()\n    },\n    /**\n     * @augments 接收用户触发的关闭\n     */\n    async handleEsc () {\n      this.closeSuggestion()\n      await this.$nextTick()\n      this.$emit('close')\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.panel-search {\n  margin: 20px;\n  width: 100%;\n  .panel-search__input-group {\n    height: 240px;\n    .panel-search__logo {\n      width: 80px;\n      height: 80px;\n      margin-bottom: 20px;\n    }\n    .panel-search__input {\n      width: 500px;\n    }\n    .panel-search__tip {\n      @extend %unable-select;\n      margin-top: 20px;\n      margin-bottom: 40px;\n      font-size: 12px;\n      color: $color-text-sub;\n      .panel-search__key {\n        padding: 1px 5px;\n        margin: 0px 2px;\n        border-radius: 2px;\n        background-color: $color-text-normal;\n        color: $color-bg;\n      }\n    }\n  }\n  .panel-search__results-group {\n    overflow: auto;\n    margin-bottom: -20px;\n    .panel-search__results-group-inner {\n      margin: -20px;\n    }\n  }\n}\n</style>\n"]}]}